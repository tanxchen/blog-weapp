export default [
  {
    "_id": "5ce411cb9ae55c41e3feed98",
    "meta": {
      "createDate": "2019-05-21 22:57:15",
      "updateDate": "2019-05-21 22:59:01"
    },
    "tags": [
      "vue"
    ],
    "title": "vueæºç é˜…è¯»ä¹‹å“åº”å¼åŸç†",
    "content": "Vue ä¸­å¯¹æ•°æ®çš„å“åº”å¼ï¼Œå³å¯¹ `props`ã€`data`ã€`computed` çš„å˜åŒ–è¿›è¡Œå“åº”å¼æ›´æ”¹ã€‚\n\nå…¶å…¥å£æ˜¯åœ¨ `src/core/instance/init.js` é‡Œçš„ `initState(vm)` é‡Œè¿›è¡Œå®ç°çš„ã€‚\n\n`initState(vm)` é‡Œ åˆå§‹åŒ–äº† `props`, `methods`, `data`, `computed`, `watch`ã€‚\n\n### initData\n\nä» `initData` å…¥æ‰‹æ¥çœ‹ä¸‹ï¼š\n```js\nfunction initData (vm: Component) {\n  let data = vm.$options.data\n  // å°†_dataä½œä¸ºä¸­é—´å˜é‡ï¼Œåç»­ proxy é‡Œä¼šç”¨åˆ°\n  data = vm._data = typeof data === 'function'\n    ? getData(data, vm) // getData åšäº†é”™è¯¯å¤„ç†ï¼Œå¹¶æ§åˆ¶äº† Dep.targetï¼Œä½¿å¾—é¿å…åœ¨è·å– data åˆå§‹å€¼çš„è¿‡ç¨‹ä¸­æ„å¤–åœ°æŠŠä¾èµ–è®°å½•ä¸‹æ¥ã€‚\n    : data || {}\n  // çœç•¥ç›¸å…³ warn ä»£ç ...\n  // è¿›è¡Œ data proxy methods é‡å¤ key çš„æ£€éªŒå¹¶æŠ›å‡º warn msg\n  // proxy data on instance\n  const keys = Object.keys(data)\n  const props = vm.$options.props\n  const methods = vm.$options.methods\n  let i = keys.length\n  while (i--) {\n    const key = keys[i]\n    // çœç•¥ç›¸å…³å…³äºé‡å¤ key æ£€æµ‹ warn ä»£ç \n    // å¯¹ _data å¯¹è±¡ä¸Šçš„æ¯ä¸ª key è¿›è¡Œ getter setter è®¾ç½®\n    // ä½¿å¾—è®¿é—® this.xxx ä»£ç†åˆ° this._data.xxx\n    proxy(vm, `_data`, key)\n  }\n  // observe data\n  /**\n   * å“åº”å¼æ ¸å¿ƒæ–¹æ³•\n   * å³ new Observer(value)\n   * å…·ä½“çœ‹ new Observer(value) é€»è¾‘\n   * */\n  observe(data, true /* asRootData */)\n}\n```\n\n`initData` é‡Œé¦–å…ˆå°†åŸå§‹ data å¤åˆ¶äº†ä»½ _dataï¼Œç„¶åéå†äº†æ¯ä¸ª keyï¼Œ\né€šè¿‡ `proxy` æ–¹æ³•å¯¹ _data é‡Œçš„ key è¿›è¡Œäº† getter setter è®¾ç½®ã€‚\n\nä½¿å¾—è®¿é—® this.xxx ä»£ç†åˆ° this._data.xxxã€‚\n\næ¥ä¸‹æ¥æ‰§è¡Œ `observe(data, true /* asRootData */)`ã€‚\n\nè¯¥æ–¹æ³•ç»“æœæ˜¯ `return new Observer(value)`ï¼Œè¿”å›äº†ä¸€ä¸ª `Observer` å®ä¾‹ã€‚\n### Observer\næ¥çœ‹ä¸‹ `Observer` ç±»çš„å®šä¹‰ï¼Œè¿™ä¹Ÿæ˜¯å“åº”å¼å®ç°çš„ä¸»è¦åœ°æ–¹ã€‚\n\n<details>\n  <summary>class Observer æºç </summary>\n\n  ```js\n  export class Observer {\n    value: any;\n    dep: Dep;\n    vmCount: number; // number of vms that has this object as root $data\n\n    constructor (value: any) {\n      this.value = value\n      this.dep = new Dep()\n      this.vmCount = 0\n      // æ·»åŠ  __ob__ å±æ€§ï¼Œå€¼ä¸ºè‡ªèº«ï¼Œå³ this.data.__ob__ = this\n      def(value, '__ob__', this)\n      if (Array.isArray(value)) {\n        // å¯¹æ•°ç»„åŸç”Ÿæ–¹æ³•è¿›è¡Œäº†åŠ«æŒï¼Œä½¿å¾—push ç­‰èƒ½ç›‘æ§åˆ°ï¼Œæ¥è§¦å‘å“åº”å¼ï¼Œä½†æ— æ³•ç›‘æ§åˆ° é€šè¿‡ä¸‹æ ‡æ›´æ”¹çš„æƒ…å†µ\n        if (hasProto) {\n          protoAugment(value, arrayMethods)\n        } else {\n          copyAugment(value, arrayMethods, arrayKeys)\n        }\n        // å¯¹æ•°ç»„è¿›è¡Œéå†æ‰§è¡Œ observe\n        this.observeArray(value)\n      } else {\n        // ä¼šè¿›å…¥ walk æ–¹æ³•\n        this.walk(value)\n      }\n    }\n\n    /**\n     * Walk through each property and convert them into\n     * getter/setters. This method should only be called when\n     * value type is Object.\n     */\n    walk (obj: Object) {\n      const keys = Object.keys(obj)\n      for (let i = 0; i < keys.length; i++) {\n        // é€šè¿‡ defineReactive æ–¹æ³•ï¼Œè®¾ç½® getter setter, çœŸæ­£çš„å“åº”ä»£ç \n        defineReactive(obj, keys[i])\n      }\n    }\n\n    /**\n     * Observe a list of Array items.\n     */\n    observeArray (items: Array<any>) {\n      for (let i = 0, l = items.length; i < l; i++) {\n        observe(items[i])\n      }\n    }\n  }\n  ```\n</details>\n\n`Observer` åœ¨ new çš„æ—¶å€™ï¼Œä¸»è¦é€»è¾‘ä¼šå…ˆæ‰§è¡Œ `this.dep = new Dep()` æ¥åˆ›å»ºä¾èµ–å®ä¾‹ï¼Œç„¶åå¤„ç†æ•°ç»„/å¯¹è±¡çš„æƒ…å†µã€‚\n\nè¿™ä¸­é—´è¿˜å¯¹é‡Œé¢çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œäº†æ·±åº¦éå†ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ å‡æ˜¯å“åº”å¼çš„ã€‚\n\nå†ä¸»è¦æ¥çœ‹ `this.walk(value)` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡ `defineReactive` æ–¹æ³•ï¼Œè®¾ç½® getter setterï¼Œè¿™æ˜¯çœŸæ­£çš„å“åº”ä»£ç ã€‚\n<details>\n  <summary>defineReactive æºç </summary>\n\n  ```js\n  export function defineReactive (\n    obj: Object,\n    key: string,\n    val: any,\n    customSetter?: ?Function,\n    shallow?: boolean\n  ) {\n    // ç¼“å­˜ä¾èµ–\n    const dep = new Dep()\n\n    const property = Object.getOwnPropertyDescriptor(obj, key)\n    if (property && property.configurable === false) {\n      return\n    }\n\n    // cater for pre-defined getter/setters\n    // è¿™é‡Œä»£ç ç±»æ¯” computed é‡Œå±æ€§å®šä¹‰çš„ getter setter é‚£æ ·\n    // å®šä¹‰äº†ï¼Œå°±ç”¨å®šä¹‰çš„ getter setter æ–¹æ³•\n    const getter = property && property.get\n    const setter = property && property.set\n    if ((!getter || setter) && arguments.length === 2) {\n      val = obj[key]\n    }\n    // childObserve å¯¹è±¡ï¼Œå¯¹ child è¿›è¡Œç›‘å¬\n    let childOb = !shallow && observe(val)\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      // è¿™æ­¥ä¸»è¦æ”¶é›†ä¾èµ–ï¼Œå¹¶è¿”å›å€¼\n      get: function reactiveGetter () {\n        // å…¼å®¹ä½¿ç”¨å®šä¹‰çš„ getter æƒ…å†µ\n        const value = getter ? getter.call(obj) : val\n        if (Dep.target) {\n          dep.depend()\n          if (childOb) {\n            childOb.dep.depend()\n            if (Array.isArray(value)) {\n              dependArray(value)\n            }\n          }\n        }\n        return value\n      },\n      // è¿™æ­¥è§¦å‘ä¾èµ–å¹¶è®¾ç½®å€¼\n      set: function reactiveSetter (newVal) {\n        const value = getter ? getter.call(obj) : val\n        /* eslint-disable no-self-compare */\n        if (newVal === value || (newVal !== newVal && value !== value)) {\n          return\n        }\n        /* eslint-enable no-self-compare */\n        if (process.env.NODE_ENV !== 'production' && customSetter) {\n          customSetter()\n        }\n        // #7981: for accessor properties without setter\n        if (getter && !setter) return\n        // è‡ªå·±å®šä¹‰äº† setter å°±è°ƒç”¨è‡ªå·±çš„ setter, æ²¡æœ‰å°±ç›´æ¥èµ‹å€¼\n        if (setter) {\n          setter.call(obj, newVal)\n        } else {\n          val = newVal\n        }\n        // newVal æ˜¯ä¸ª objectï¼Œåˆ™ç»§ç»­é€’å½’æ‰§è¡Œç›‘å¬ observe\n        childOb = !shallow && observe(newVal)\n        // è§¦å‘æ›´æ–°\n        dep.notify()\n      }\n    })\n  }\n  ```\n</details>\n\n`defineReactive` ä»£ç å¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š\n```js\n_defineReactive (obj, key, val) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    configurable: true,\n    enumerable: true,\n    get: function reactiveGetter() {\n      dep.addSub(Dep.target)\n      return val\n    },\n    set: function reactiveSetter(newVal) {\n      const value = getter ? getter.call(obj) : val\n      if (newVal === value) return\n      // è‡ªå·±å®šä¹‰äº† setter å°±è°ƒç”¨è‡ªå·±çš„ setter, æ²¡æœ‰å°±ç›´æ¥èµ‹å€¼\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      dep.notify()\n    }\n  })\n}\n```\nåœ¨ `defineReactive` å‡½æ•°å†…ï¼Œé€šè¿‡é—­åŒ…å®ä¾‹åŒ–äº† `Dep` è¿™ä¸ªè®¢é˜…è€…ã€‚\n\n### Dep\n\n<details>\n  <summary>class Dep æºç </summary>\n\n  ```js\n  export default class Dep {\n    static target: ?Watcher;\n    id: number;\n    subs: Array<Watcher>;\n\n    constructor () {\n      this.id = uid++\n      this.subs = []\n    }\n\n    addSub (sub: Watcher) {\n      this.subs.push(sub)\n    }\n\n    removeSub (sub: Watcher) {\n      remove(this.subs, sub)\n    }\n\n    depend () {\n      if (Dep.target) {\n        // Dep.target å³ watcherï¼šwatcher.addDep(dep)\n        Dep.target.addDep(this)\n      }\n    }\n\n    notify () {\n      // stabilize the subscriber list first\n      const subs = this.subs.slice()\n      if (process.env.NODE_ENV !== 'production' && !config.async) {\n        // subs aren't sorted in scheduler if not running async\n        // we need to sort them now to make sure they fire in correct\n        // order\n        subs.sort((a, b) => a.id - b.id)\n      }\n      for (let i = 0, l = subs.length; i < l; i++) {\n        subs[i].update()\n      }\n    }\n  }\n\n  // the current target watcher being evaluated.\n  // this is globally unique because there could be only one\n  // watcher being evaluated at any time.\n  // ä¿å­˜å½“å‰å…¨å±€å”¯ä¸€å­˜åœ¨çš„ watcher\n  Dep.target = null\n  const targetStack = []\n\n  export function pushTarget (_target: ?Watcher) {\n    if (Dep.target) targetStack.push(Dep.target)\n    Dep.target = _target\n  }\n\n  export function popTarget () {\n    Dep.target = targetStack.pop()\n  }\n  ```\n</details>\n\n`Dep` è¿™é‡Œå¯ä»¥ç®€åŒ–ä¸ºï¼š\n```js\nclass Dep {\n  constructor() {\n    this.subs = []\n  }\n  addSub(sub) {\n    this.subs.push(sub)\n  }\n  notify() {\n    this.subs.forEach(sub => {\n      sub.update()\n    })\n  }\n}\n\nDep.target = null\n```\n`Dep` è¿™ä¸ªä¾èµ–è®¢é˜…è€…ï¼Œæœ‰è‡ªå·±çš„ `subs` ç”¨æ¥ç¼“å­˜ `Dep.target`ï¼Œ`Dep.target` å…¶å®æ˜¯ä¸€ä¸ª watcher å®ä¾‹ï¼Œè¿™é‡Œå…ˆä¸ç®¡ watcherã€‚\nå›åˆ° `defineReactive`ï¼Œåœ¨ get é‡Œå°† watcher å®ä¾‹æ·»åŠ åˆ°è®¢é˜…è€… Dep é‡Œï¼Œ\nåœ¨ set æ—¶éå†ç¼“å­˜åœ¨ dep.subs æ•°ç»„é‡Œçš„ watcher å®ä¾‹ï¼Œæ‰§è¡Œ `watcher.update()` æ–¹æ³•ï¼Œæ¥è§¦å‘æ›´æ–°ã€‚\n\n### Watcher\næ¥çœ‹ä¸‹ class Watcher\n\n<details>\n  <summary>class Watcher æºç </summary>\n\n  ```js\n    export default class Watcher {\n      vm: Component; // å®ä¾‹è‡ªèº«\n      expression: string;\n      cb: Function;\n      id: number;\n      deep: boolean;\n      user: boolean;\n      lazy: boolean;\n      sync: boolean;\n      dirty: boolean;\n      active: boolean;\n      deps: Array<Dep>;\n      newDeps: Array<Dep>;\n      depIds: SimpleSet; // ES6 set ç±»å‹\n      newDepIds: SimpleSet; // ES6 set ç±»å‹\n      before: ?Function;\n      getter: Function;\n      value: any;\n\n      constructor (\n        vm: Component,\n        expOrFn: string | Function, // è¡¨è¾¾å¼æœ¬èº« [ getter | noop ]\n        cb: Function, // [ noop ]\n        options?: ?Object, // { lazy: true } // å¦‚æœè®¾ç½®ä¸º true åˆ™åœ¨ç¬¬ä¸€æ¬¡ get çš„æ—¶å€™æ‰è®¡ç®—å€¼ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å¹¶ä¸è®¡ç®—ã€‚init æ—¶ä¸º true\n        isRenderWatcher?: boolean\n      ) {\n        this.vm = vm\n        if (isRenderWatcher) {\n          vm._watcher = this\n        }\n        vm._watchers.push(this)\n        // options\n        if (options) {\n          this.deep = !!options.deep\n          this.user = !!options.user\n          this.lazy = !!options.lazy\n          this.sync = !!options.sync\n          /*\n          beforeä½œç”¨æ˜¯å®šä¹‰ beforeUpdate é’©å­ï¼š\n          ã€Œ\n            before () {\n                if (vm._isMounted) {\n                  callHook(vm, 'beforeUpdate')\n                }\n              }\n            ã€\n          */\n          this.before = options.before\n        } else {\n          this.deep = this.user = this.lazy = this.sync = false\n        }\n        this.cb = cb\n        this.id = ++uid // uid for batching\n        this.active = true\n        this.dirty = this.lazy // for lazy watchers\n        // ä¸¤ä¸ªæ•°ç»„ï¼Œ\n        this.deps = []\n        this.newDeps = []\n        // ä¸¤ä¸ªid ä¸º set å®ä¾‹,åœ¨ add æ—¶å€™ï¼Œé˜²æ­¢é‡å¤æ·»åŠ ç›¸åŒ id\n        this.depIds = new Set()\n        this.newDepIds = new Set()\n        this.expression = process.env.NODE_ENV !== 'production'\n          ? expOrFn.toString()\n          : ''\n        // parse expression for getter\n        if (typeof expOrFn === 'function') {\n          this.getter = expOrFn\n        } else {\n          this.getter = parsePath(expOrFn)\n          if (!this.getter) {\n            this.getter = noop\n            process.env.NODE_ENV !== 'production' && warn(\n              `Failed watching path: \"${expOrFn}\" ` +\n              'Watcher only accepts simple dot-delimited paths. ' +\n              'For full control, use a function instead.',\n              vm\n            )\n          }\n        }\n        this.value = this.lazy\n          ? undefined\n          : this.get()\n      }\n\n      /**\n       * Evaluate the getter, and re-collect dependencies.\n       */\n      // æ‰§è¡Œ getter, å¹¶é‡æ–°æ”¶é›†ä¾èµ–å…³ç³»\n      get () {\n        /* pushTarget ä»£ç ï¼š\n        ã€Œ\n            Dep.target = null\n            const targetStack = []\n\n            export function pushTarget (_target: ?Watcher) {\n              if (Dep.target) targetStack.push(Dep.target)\n              Dep.target = _target\n            }\n\n            export function popTarget () {\n              Dep.target = targetStack.pop()\n            }\n          ã€\n        */\n        // è¿™è¡Œä»£ç ä½œç”¨ï¼šåœ¨è¿›è¡Œ get å–å€¼æ—¶ï¼Œä½¿å¾— Dep.target ä¸º watcher å®ä¾‹è‡ªèº«\n        pushTarget(this)\n        let value\n        const vm = this.vm\n        try {\n          value = this.getter.call(vm, vm)\n        } catch (e) {\n          if (this.user) {\n            handleError(e, vm, `getter for watcher \"${this.expression}\"`)\n          } else {\n            throw e\n          }\n        } finally {\n          // \"touch\" every property so they are all tracked as\n          // dependencies for deep watching\n          if (this.deep) {\n            traverse(value)\n          }\n          popTarget()\n          this.cleanupDeps()\n        }\n        return value\n      }\n\n      /**\n       * Add a dependency to this directive.\n       */\n      addDep (dep: Dep) {\n        const id = dep.id\n        // if (!this.newDepIds.has(id)) åˆ¤æ–­ï¼Œä¸ºäº†é˜²æ­¢å¦‚ computed é‡Œ\n        // `return this.a + this.a` è¿™ç§ç›¸åŒå€¼çš„è®¡ç®—æƒ…å†µ\n        if (!this.newDepIds.has(id)) {\n          this.newDepIds.add(id)\n          this.newDeps.push(dep)\n          if (!this.depIds.has(id)) {\n            dep.addSub(this)\n          }\n        }\n      }\n\n      /**\n       * Clean up for dependency collection.\n       */\n      cleanupDeps () {\n        let i = this.deps.length\n        while (i--) {\n          const dep = this.deps[i]\n          if (!this.newDepIds.has(dep.id)) {\n            dep.removeSub(this)\n          }\n        }\n        let tmp = this.depIds\n        this.depIds = this.newDepIds\n        this.newDepIds = tmp\n        this.newDepIds.clear()\n        tmp = this.deps\n        this.deps = this.newDeps\n        this.newDeps = tmp\n        this.newDeps.length = 0\n      }\n\n      /**\n       * Subscriber interface.\n       * Will be called when a dependency changes.\n       */\n      update () {\n        /* istanbul ignore else */\n        if (this.lazy) {\n          this.dirty = true\n        } else if (this.sync) {\n          this.run()\n        } else {\n          queueWatcher(this)\n        }\n      }\n\n      /**\n       * Scheduler job interface.\n       * Will be called by the scheduler.\n       */\n      run () {\n        if (this.active) {\n          const value = this.get()\n          if (\n            value !== this.value ||\n            // Deep watchers and watchers on Object/Arrays should fire even\n            // when the value is the same, because the value may\n            // have mutated.\n            isObject(value) ||\n            this.deep\n          ) {\n            // set new value\n            const oldValue = this.value\n            this.value = value\n            if (this.user) {\n              try {\n                this.cb.call(this.vm, value, oldValue)\n              } catch (e) {\n                handleError(e, this.vm, `callback for watcher \"${this.expression}\"`)\n              }\n            } else {\n              this.cb.call(this.vm, value, oldValue)\n            }\n          }\n        }\n      }\n\n      /**\n       * Evaluate the value of the watcher.\n       * This only gets called for lazy watchers.\n       */\n      evaluate () {\n        this.value = this.get()\n        this.dirty = false\n      }\n\n      /**\n       * Depend on all deps collected by this watcher.\n       */\n      depend () {\n        let i = this.deps.length\n        while (i--) {\n          this.deps[i].depend()\n        }\n      }\n\n      /**\n       * Remove self from all dependencies' subscriber list.\n       */\n      teardown () {\n        if (this.active) {\n          // remove self from vm's watcher list\n          // this is a somewhat expensive operation so we skip it\n          // if the vm is being destroyed.\n          if (!this.vm._isBeingDestroyed) {\n            remove(this.vm._watchers, this)\n          }\n          let i = this.deps.length\n          while (i--) {\n            this.deps[i].removeSub(this)\n          }\n          this.active = false\n        }\n      }\n    }\n  ```\n</details>\n\nä¸Šé¢è¯´åˆ°åœ¨ set æŸä¸ªå€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼šæ‰§è¡Œ `watcher.update()` æ–¹æ³•ã€‚æ¥çœ‹ä¸‹è¿™ä¸ª update æ–¹æ³•ï¼š\n```js\nupdate () {\n  /* istanbul ignore else */\n  if (this.lazy) {\n    this.dirty = true\n  } else if (this.sync) {\n    this.run()\n  } else {\n    queueWatcher(this)\n  }\n}\n```\nupdate æ–¹æ³•ï¼ŒåŒæ­¥æƒ…å†µæ‰§è¡Œ `this.run()` ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯å¼‚æ­¥ï¼Œä¼šè¿›å…¥åˆ°æœ€åä¸ª else é‡Œï¼Œæ‰§è¡Œ `queueWatcher(this)`ã€‚\n\n`queueWatcher` é‡Œä¸»è¦ä»£ç  `nextTick(flushSchedulerQueue)`ï¼Œå®ƒå°† watch é˜Ÿåˆ—æ”¾åˆ° nextTick é‡Œç»Ÿä¸€æ‰§è¡Œï¼Œè¿™ä¹Ÿä½¿å¾—è¿ç»­ set åŒä¸ªæ•°æ®ä¸¤æ¬¡ä¸åŒå€¼ï¼Œä¸ä¼šæ›´æ–°ä¸¤æ¬¡è§†å›¾ï¼Œæå‡äº†ä¸€å®šæ€§èƒ½ã€‚\n\n### computed çš„åŸç†\næ³¨æ„ watcher å®ä¾‹åŒ– constructor æœ€åè¡Œæœ‰ä¸ª `this.value`:\n```js\nthis.value = this.lazy\n  ? undefined\n  : this.get()\n```\nè¿™ä¸ª valueï¼Œåœ¨ `initComputed` çš„æ—¶å€™ï¼Œä¼šå¯¹ computed é‡Œçš„æ¯ä¸ª key `new Watcher(...)`ï¼Œæ‰€ä»¥å¯ä»¥è¯´æ˜¯ computed çš„åŒå‘ç»‘å®šå®ç°å³æ˜¯é€šè¿‡ Watcher æ¥å“åº”å˜åŒ–ã€‚\n\n<details>\n  <summary>initComputed æºç å‡½æ•°ï¼š</summary>\n\n  ```js\n  const computedWatcherOptions = { lazy: true }\n\n  function initComputed (vm: Component, computed: Object) {\n    // $flow-disable-line\n    const watchers = vm._computedWatchers = Object.create(null)\n    // computed properties are just getters during SSR\n    const isSSR = isServerRendering()\n\n    // éå†å®šä¹‰åœ¨ computed ä¸Šçš„ key\n    for (const key in computed) {\n      const userDef = computed[key]\n      // å¤„ç†è‡ªå®šä¹‰ getter æƒ…å†µ\n      const getter = typeof userDef === 'function' ? userDef : userDef.get\n      if (process.env.NODE_ENV !== 'production' && getter == null) {\n        warn(\n          `Getter is missing for computed property \"${key}\".`,\n          vm\n        )\n      }\n      // é ssr æƒ…å†µï¼Œå¯¹ key è¿›è¡Œ ç›‘æ§ï¼Œssr ä¸‹å°±ä¸éœ€è¦ç›‘æ§äº†\n      if (!isSSR) {\n        // create internal watcher for the computed property.\n        // å¯¹æ¯ä¸ªkey è®¾ç½® Watcher\n        watchers[key] = new Watcher(\n          vm,\n          getter || noop,\n          noop,\n          computedWatcherOptions\n        )\n      }\n      // component-defined computed properties are already defined on the\n      // component prototype. We only need to define computed properties defined\n      // at instantiation here.\n      if (!(key in vm)) {\n        // å°† computed é‡Œå®šä¹‰çš„ key åœ¨å®ä¾‹ä¸Šæ·»åŠ è¿›è¡Œä»£ç†ï¼Œä½¿å¾—å¯ç›´æ¥é€šè¿‡ this.xx æ¥è®¿é—®\n        defineComputed(vm, key, userDef)\n      } else if (process.env.NODE_ENV !== 'production') {\n        if (key in vm.$data) {\n          warn(`The computed property \"${key}\" is already defined in data.`, vm)\n        } else if (vm.$options.props && key in vm.$options.props) {\n          warn(`The computed property \"${key}\" is already defined as a prop.`, vm)\n        }\n      }\n    }\n  }\n  ```\n</details>\n\nä»ä¸Šé¢ä¼ å…¥å‚æ•° `{ lazy: true }` å¯çŸ¥ï¼Œåˆå§‹åŒ–æ—¶ value ä¸º `undefined`ï¼Œ\n`defineComputed(vm, key, userDef)` å³ `Object.defineProperty(target, key, sharedPropertyDefinition)`.\nåœ¨ `sharedPropertyDefinition` é‡Œä¼šæ‹¿ä¹‹å‰ watcher è¿‡çš„ä¾èµ–çš„å€¼ï¼š\n```js\nfunction createComputedGetter (key) {\n  return function computedGetter () {\n    const watcher = this._computedWatchers && this._computedWatchers[key]\n    if (watcher) {\n      if (watcher.dirty) {\n        watcher.evaluate()\n      }\n      if (Dep.target) {\n        watcher.depend()\n      }\n      return watcher.value\n    }\n  }\n}\n```\næ‰€ä»¥ computed ä¸­çš„å€¼åœ¨è¯»å–çš„æ—¶å€™ï¼Œæ‹¿åˆ°çš„ç»“æœå³ watcher.valueã€‚\n\n**æ€»ç»“ä¸‹ data å“åº”å¼æµç¨‹ï¼š**\n\nthis.xx ä»£ç†åˆ° this._data.xx ç„¶å _data åœ¨ Observer é‡Œå®šä¹‰è¿‡ setter getterï¼Œåœ¨åˆå§‹ render æ—¶ä¼šæ”¶é›†ä¾èµ–åˆ°é—­åŒ…çš„ Dep ä¾èµ–å®ä¾‹çš„æ•°ç»„é‡Œï¼Œåœ¨ setter æ—¶ä¼šé€šçŸ¥æ‰€æœ‰ä¾èµ–å³æ¯ä¸ª watcher å®ä¾‹è¿›è¡Œ update æ›´æ–°ã€‚\n\n**æ€»ç»“ä¸‹ computed å“åº”å¼æµç¨‹ï¼š**\n\nthis.xx åˆå§‹åŒ–æ—¶ä¼šå…ˆåˆ›å»ºä¸€ä¸ª watcherï¼Œç„¶åé€šè¿‡ `Object.defineProperty` è¿›è¡Œ setter,getter è®¾ç½®ï¼Œå…¶ä¸­ getter ä¼šå¾—åˆ°æ˜¯ watcher.value çš„å€¼ã€‚\n\n\n**æ³¨æ„ï¼š**\n> Observer æ–‡ä»¶ä¸‹å®šä¹‰äº†ä¸ª `arrayMethods`ï¼Œè¯¥æ–¹æ³•é‡å†™äº†æ•°ç»„æ–¹æ³•ï¼Œä½¿å¾—æ”¹å˜ push ç­‰æ“ä½œä¹Ÿèƒ½è§¦å‘æ›´æ–°ã€‚\n```js\nmethodsToPatch.forEach(function (method) {\n  // cache original method\n  const original = arrayProto[method]\n  def(arrayMethods, method, function mutator (...args) {\n    const result = original.apply(this, args)\n    const ob = this.__ob__\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n    }\n    if (inserted) ob.observeArray(inserted)\n    // notify change\n    ob.dep.notify()\n    return result\n  })\n})\n```\n\né™„ï¼š\n[å®ç°vueç²¾ç®€ç‰ˆå“åº”å¼ä»£ç ](https://github.com/ryanxchen/knowledge-note/blob/master/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/vuejs/mvvm.html#L1-L137)",
    "__v": 0
  },
  {
    "_id": "5cdd790c9ae55c41e3feed97",
    "meta": {
      "createDate": "2019-05-16 22:51:56",
      "updateDate": "2019-05-16 22:51:56"
    },
    "tags": [
      "vue"
    ],
    "title": "vueæºç é˜…è¯»ä¹‹åˆå§‹åŒ–è¿‡ç¨‹",
    "content": "### importé˜¶æ®µ\nä»æ‰“åŒ…å…¥å£æ–‡ä»¶å…¥æ‰‹ï¼Œ`scripts/config.js`, â¡ï¸ `resolve('web/entry-runtime.js')`\nâ¤µï¸\nå…¥å£æ–‡ä»¶ `src/platforms/entry-runtime.js`, `platforms` æ–‡ä»¶å¤¹æ˜¯è·Ÿå¹³å°ç›¸å…³çš„ä»£ç \nâ¤µï¸\n`src/platforms/web/runtime/index.js`ï¼Œ`runtime/index.js` é‡Œå¯¹è¯¥è¿è¡Œæ—¶ä»£ç åšäº†ç‰¹æ®Šå¤„ç†\nâ¤µï¸\n`src/code/index.js`,çœŸæ­£å…¥å£æ–‡ä»¶\n```js\nimport Vue from './instance/index'\n// ...\ninitGlobalAPI(Vue)\n// ...ssrç›¸å…³ä»£ç \nVue.version = '__VERSION__'\n\nexport default Vue\n```\nâ¤µï¸\n`src/core/instance/index.js`\n```js\nfunction Vue (options) {\n  // ...\n  this._init(options)\n}\n// æ·»åŠ  _init å‡½æ•°\ninitMixin(Vue)\n// ä¸»è¦æ˜¯æ·»åŠ äº† $data,$props,$watch,$set,$delete å‡ ä¸ªå±æ€§å’Œæ–¹æ³•\nstateMixin(Vue)\n// ä¸»è¦æ˜¯æ·»åŠ äº† $on,$off,$once,$emit ä¸‰ä¸ªæ–¹æ³•\neventsMixin(Vue)\n// ä¸»è¦æ·»åŠ äº† _update, $forceUpdate, $destroy ä¸‰ä¸ªæ–¹æ³•\nlifecycleMixin(Vue)\n// ä¸»è¦æ·»åŠ äº† $nextTick å’Œ _render ä¸¤ä¸ªæ–¹æ³•ä»¥åŠä¸€å¤§å †renderHelpers\nrenderMixin(Vue)\n\nexport default Vue\n```\n`instance/index.js` ä½œç”¨æ˜¯æŒ‰åŠŸèƒ½æ¨¡å—å¾€ `Vue` åŸå‹å’Œè‡ªèº«æ·»åŠ äº†è®¸å¤šå±æ€§å’Œæ–¹æ³•ã€‚\nå†å›åˆ° `initGlobalAPI(Vue)`.\n```js\n// ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯å®ä¾‹é‡Œçš„æ–¹æ³•\nVue.set = set\nVue.delete = del\nVue.nextTick = nextTick\n\nVue.options = Object.create(null)\n// å¾ªç¯å‡ºæ¥çš„ç»“æœå…¶å®æ˜¯ä¸‰ä¸ª `components`,`directives`, `filters`\nASSET_TYPES.forEach(type => {\n  Vue.options[type + 's'] = Object.create(null)\n})\n\n// this is used to identify the \"base\" constructor to extend all plain-object\n// components with in Weex's multi-instance scenarios.\nVue.options._base = Vue\n\n// builtInComponents ä»…ä¸ºå†…ç½®ç»„ä»¶ KeepAlive\nextend(Vue.options.components, builtInComponents)\n\ninitUse(Vue) // æ·»åŠ  Vue.use\ninitMixin(Vue) // æ·»åŠ  Vue.mixin\ninitExtend(Vue) // æ·»åŠ  Vue.extend\n// æ·»åŠ  Vue.component, Vue.directive, Vue.filter æ–¹æ³•\ninitAssetRegisters(Vue)\n```\n`initGlobalAPI` ä½œç”¨ä¹Ÿæ˜¯ç»§ç»­æ·»åŠ äº†ä¸€äº›å…¨å±€æ–¹æ³•ã€‚\nç°åœ¨ function Vue å¤§è‡´å°±å˜æˆäº†å¦‚ä¸‹æ ·å­ï¼š\n```js\n//æ„é€ å‡½æ•°\nfunction Vue () {\n  this._init()\n}\n\n//å…¨å±€configå¯¹è±¡ï¼Œæˆ‘ä»¬å‡ ä¹ä¸ä¼šç”¨åˆ°\nVue.config = {\n  keyCodes,\n  _lifecycleHooks: ['beforeCreate', 'created', ...]\n}\n\n// é»˜è®¤çš„optionsé…ç½®ï¼Œæˆ‘ä»¬æ¯ä¸ªç»„ä»¶éƒ½ä¼šç»§æ‰¿è¿™ä¸ªé…ç½®ã€‚\nVue.options = {\n  beforeCreate, // æ¯”å¦‚ vue-router å°±ä¼šæ³¨å†Œè¿™ä¸ªå›è°ƒï¼Œå› æ­¤ä¼šæ¯ä¸€ä¸ªç»„ä»¶ç»§æ‰¿\n  components, // å‰é¢æåˆ°äº†ï¼Œé»˜è®¤ç»„ä»¶æœ‰ä¸‰ä¸ª `KeepAlive`,`transition`, `transitionGroup`ï¼Œè¿™é‡Œæ³¨å†Œçš„ç»„ä»¶å°±æ˜¯å…¨å±€ç»„ä»¶ï¼Œå› ä¸ºä»»ä½•ä¸€ä¸ªç»„ä»¶ä¸­ä¸ç”¨å£°æ˜å°±èƒ½ç”¨äº†ã€‚æ‰€ä»¥å…¨å±€ç»„ä»¶çš„åŸç†å°±æ˜¯è¿™ä¹ˆç®€å•\n  directives, // é»˜è®¤åªæœ‰ `v-show` å’Œ `v-model`\n  filters\n}\n\n//ä¸€äº›å…¨å±€æ–¹æ³•\nVue.use // æ³¨å†Œæ’ä»¶\nVue.component // æ³¨å†Œç»„ä»¶\nVue.directive // æ³¨å†ŒæŒ‡ä»¤\nVue.nextTick //ä¸‹ä¸€ä¸ªtickæ‰§è¡Œå‡½æ•°\nVue.set/delete // æ•°æ®çš„ä¿®æ”¹æ“ä½œ\nVue.mixin // æ··å…¥mixinç”¨çš„\n\n//Vue.prototype ä¸Šæœ‰å‡ ç§ä¸åŒä½œç”¨çš„æ–¹æ³•\n\n//ç”±initMixin æ·»åŠ çš„ `_init` æ–¹æ³•ï¼Œæ˜¯Vueå®ä¾‹åˆå§‹åŒ–çš„å…¥å£æ–¹æ³•ï¼Œä¼šè°ƒç”¨å…¶ä»–çš„åŠŸèƒ½åˆå§‹è¯å‡½æ•°\nVue.prototype._init\n\n// ç”± initState æ·»åŠ çš„ä¸‰ä¸ªç”¨æ¥è¿›è¡Œæ•°æ®æ“ä½œçš„æ–¹æ³•\nVue.prototype.$data\nVue.prototype.$props\nVue.prototype.$watch\nVue.prototype.$set\nVue.prototype.$delete\n\n// ç”±initEventsæ·»åŠ çš„äº‹ä»¶æ–¹æ³•\nVue.prototype.$on\nVue.prototype.$off\nVue.prototype.$one\nVue.prototype.$emit\n\n// ç”± lifecycleæ·»åŠ çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•\nVue.prototype._update\nVue.prototype.$forceUpdate\nVue.prototype.$destroy\n\n//åœ¨ platform ä¸­æ·»åŠ çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•\nVue.prototype.$mount\n\n// ç”±renderMixinæ·»åŠ çš„`$nextTick` å’Œ `_render` ä»¥åŠä¸€å †renderHelper\nVue.prototype.$nextTick\nVue.prototype._render\nVue.prototype._b\nVue.prototype._e\n//...\n```\n\n### å®ä¾‹åŒ–é˜¶æ®µ[new Vue({...})]\nä»£ç åœ¨ `src/core/instance/init.js` é‡Œã€‚\nä¸»è¦åŠŸèƒ½ä»£ç ï¼š\n* ç”Ÿæˆè‡ªå¢çš„å”¯ä¸€IDæ ‡è¯† `vm._uid = uid++`\n* åˆå¹¶ `vm.constructor` å’Œä¼ å…¥çš„ `options`ï¼Œç”Ÿæˆ `vm.$options`\n  * è¿™ä¸€æ­¥ä½¿å¾—å¯ä»¥åœ¨å­ç»„ä»¶èƒ½å¤Ÿä½¿ç”¨å…¨å±€çš„ directivesã€filters ç­‰æ–¹æ³•\n* æŒ‚è½½è‡ªèº« `vm._self = vm`\n* åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€æ¸²æŸ“ç­‰ç›¸å…³é’©å­å·¥ä½œ\n  * initLifecycle(vm)\n    * å®šä½ç¬¬ä¸€ä¸ªéæŠ½è±¡çˆ¶çº§ï¼Œå¹¶æ·»åŠ åˆ° $children é‡Œï¼Œ`parent.$children.push(vm)`\n    * æ·»åŠ å¾ˆå¤šå˜é‡ï¼Œä¸»è¦ä¸º $parentã€$childrenï¼Œ$refs ä¹Ÿåœ¨è¿™é‡Œå®šä¹‰äº†ï¼Œå…¶ä»– `_`å¼€å¤´çš„å˜é‡å‡ä¸º\bç”Ÿå‘½å‘¨æœŸä¸åŒé˜¶æ®µçŠ¶æ€çš„ flag\n      * vm.$parent = parent\n      * vm.$root = parent ? parent.$root : vm\n      * vm.$children = []\n      * vm.$refs = {}\n      * vm._watcher = null\n      * vm._inactive = null\n      * vm._directInactive = false\n      * vm._isMounted = false\n      * vm._isDestroyed = false\n      * vm._isBeingDestroyed = false\n  * initEvents(vm)\n    * > **æ³¨å†Œçš„æ˜¯çˆ¶ç»„ä»¶äº‹ä»¶**\n  * initRender(vm)\n    * åš render çš„å‡†å¤‡å·¥ä½œï¼Œå¹¶æœªå¼€å§‹ renderï¼Œå¦‚åˆ›å»º vm._vnodeï¼Œvm.$createElementï¼Œ$attrs å’Œ $listeners\n  * callHook(vm, 'beforeCreate')\n    * è°ƒç”¨ `beforeCreate` ç”Ÿå‘½å‘¨æœŸé’©å­\n    * > callHook é‡Œå®šä¹‰äº†ï¼š`if (vm._hasHookEvent) {vm.$emit('hook:' + hook)}`ï¼Œæ‰€ä»¥æœ‰ä¸ªå°æŠ€å·§å®ç°åœ¨åœ¨çˆ¶ç»„ä»¶é€šè¿‡ `hook` é’©å­ï¼Œç›‘å¬å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•:\n    * \n      ```html \n        <Chind-Component @hook:updated=\"doSomething\" /> \n      ```\n  * initInjections(vm) // resolve injections before data/props\n  * initState(vm)\n    * `data`, `props`, `computed` ç­‰éƒ½æ˜¯åœ¨è¿™é‡Œåˆå§‹åŒ–çš„ï¼Œå¸¸è§çš„é¢è¯•è€ƒç‚¹æ¯”å¦‚`Vueæ˜¯å¦‚ä½•å®ç°æ•°æ®å“åº”åŒ–çš„` ç­”æ¡ˆå°±åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¯»æ‰¾\n  * initProvide(vm) // resolve provide after data/props\n  * callHook(vm, 'created')\n    * è°ƒç”¨ `created` ç”Ÿå‘½å‘¨æœŸé’©å­\n* å­˜åœ¨ el ,åˆ™è°ƒç”¨ `$mount`ï¼Œ`vm.$mount(vm.$options.el)`\n  * å½“ç„¶ï¼Œel ä¹Ÿå¯ä»¥ä¸å†™ï¼Œè€Œæ˜¯åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ç›´æ¥è°ƒç”¨ï¼š `new Vue({...}).$mount('#app')`",
    "__v": 0
  },
  {
    "_id": "5cda85489ae55c41e3feed96",
    "meta": {
      "createDate": "2019-05-14 17:07:20",
      "updateDate": "2019-05-14 17:23:12"
    },
    "tags": [
      "nodejs"
    ],
    "title": "koaä¸­é—´ä»¶åŸç†",
    "content": "koa åŠŸèƒ½\n* å°è£… http æ¨¡å—ã€lib/application ä¸‹çš„ listen æ–¹æ³•ã€‘\n* æ„å»ºä¸­é—´ä»¶æ¨¡å‹ã€é€šè¿‡ koa-compose åŒ…ã€‘\n* æ•´åˆäº†request,response,contextã€lib/application ä¸‹çš„ createContext æ–¹æ³•ã€‘\n* é”™è¯¯å¤„ç†ã€lib/application ä¸‹çš„ onerror æ–¹æ³•ã€‘\n\nä¸€ä¸ªåŸºç¡€æ¨¡æ¿ä»£ç å¦‚ä¸‹ï¼š\n```js\nconst Koa = require('koa');\nconst app = new Koa();\n\n// logger\napp.use(async (ctx, next) => {\n  await next();\n  const rt = ctx.response.get('X-Response-Time');\n  console.log(`${ctx.method} ${ctx.url} - ${rt}`);\n});\n\n// x-response-time\napp.use(async (ctx, next) => {\n  const start = Date.now();\n  await next();\n  const ms = Date.now() - start;\n  ctx.set('X-Response-Time', `${ms}ms`);\n});\n\n// response\napp.use(async ctx => {\n  ctx.body = 'Hello World';\n});\n\napp.listen(3000);\n```\n\nkoa é‡Œï¼Œä¸­é—´ä»¶å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•° context, nextï¼Œ\né€šè¿‡ use æ–¹æ³•ï¼Œå°†å‡½æ•°æ·»åŠ åˆ° `middleware` æ•°ç»„é‡Œã€ `this.middleware.push(fn)` ã€‘ï¼Œ\nåœ¨ listen é‡Œ\n```js\nhttp.createServer(this.callback()).listen(...args);\n```\nè°ƒç”¨äº† `callback`ï¼Œåœ¨ `callback` é‡Œï¼Œé€šè¿‡ `compose(this.middleware)`ï¼Œ\nå¤„ç†ä¹‹å‰æ·»åŠ è¿‡çš„ä¸­é—´ä»¶ï¼Œè¿”å› `this.handleRequest(ctx, fn)` æ¥æ‰§è¡Œä¸­é—´ä»¶ï¼Œ\n`handleRequest` æ˜¯è¿”å› Promise å‡½æ•°çš„ï¼Œæ‰€ä»¥åœ¨ç¼–å†™ä¸­é—´ä»¶æ—¶ï¼Œå¾€å¾€é€šè¿‡ async await æ¥æ„å»ºï¼Œè¿™é‡Œä¸»è¦æ¥è§£æä¸‹ `compose`ï¼Œå®ƒæ˜¯å¼•ç”¨äº† `koa-compose` åŒ…ï¼Œä¸»è¦æºç å¦‚ä¸‹ï¼š\n```js\nfunction compose () {\n  return function (context, next) {\n    // last called middleware\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n```\n\ncompose é‡Œä¼šè¿”å› dispatch æ–¹æ³•ï¼Œdispatch é‡Œä¼šå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªfnï¼Œå¹¶å°† middleware é˜Ÿåˆ—é‡Œä¸‹ä¸€ä¸ª fn ä½œä¸º next å‚æ•°ï¼Œä¸” dispatch è¿”å›çš„ä¸º Promiseï¼Œä»è€Œå½¢æˆäº†å…ˆè¿›åå‡ºæ´‹è‘±å¼æ¨¡å‹ã€‚\n![koa-middleware](https://gitee.com/ryanxchen/img/raw/master/blog/koa-middleware.jpg)",
    "__v": 0
  },
  {
    "_id": "5ccff6409ae55c41e3feed95",
    "meta": {
      "createDate": "2019-05-06 16:54:24",
      "updateDate": "2019-05-06 16:54:24"
    },
    "tags": [
      "vue"
    ],
    "title": "Vuexæºç åˆ†æ",
    "content": "Vuexæ˜¯Vueçš„æ•°æ®çŠ¶æ€ç®¡ç†æ’ä»¶.å°†æ•°æ®æ”¾åœ¨å•ä¾‹ä¸‹çš„storeé‡Œï¼Œå¯¹æ•°æ®è¿›è¡Œç›‘æ§ç®¡ç†.\n### å¼•å…¥ã€å®‰è£…é˜¶æ®µï¼Œä»å…¥å£ index.jså¼€å§‹\n```js\nexport default {\n  Store,\n  install,\n  version: '__VERSION__',\n  mapState,\n  mapMutations,\n  mapGetters,\n  mapActions,\n  createNamespacedHelpers\n}\n```\nå¯¼å‡ºäº† Store ç±»å’Œä¸€äº›è¾…åŠ©mapå¼€å¤´çš„å‡½æ•°ã€‚\næœ€åˆåœ¨é¡¹ç›®é‡Œä½¿ç”¨Vuexæ—¶ï¼Œ`Vue.use(Vuex)`é‡Œä¾¿æ˜¯è°ƒç”¨äº†`install`æ–¹æ³•ã€‚\n```js\n// ...\nlet Vue\n// ...\n// åˆå§‹installé˜¶æ®µï¼ŒVue.use(Vuex)ä¼šè°ƒç”¨installæ–¹æ³•\nexport function install (_Vue) {\n  // Vueä¸ºstoreé‡Œå®šä¹‰ï¼Œ_Vueä¸ºè°ƒç”¨installæ—¶ä¼ å…¥çš„Vue\n  // é˜²æ­¢é‡å¤install\n  if (Vue && _Vue === Vue) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.error(\n        '[vuex] already installed. Vue.use(Vuex) should be called only once.'\n      )\n    }\n    return\n  }\n  Vue = _Vue\n  // applyMixinå‡½æ•°ä½œç”¨ï¼šå°†storeæ³¨å…¥åˆ°å­ç»„ä»¶ï¼Œå­ç»„ä»¶å¯é€šè¿‡this.$storeè®¿é—®store\n  applyMixin(Vue)\n}\n```\nstore.jsé‡Œå¯¼å‡ºäº†`install`æ–¹æ³•ã€‚åœ¨store.jså¼€å¤´å®šä¹‰å±€éƒ¨ Vue å˜é‡ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»è£…è½½å’Œå‡å°‘å…¨å±€ä½œç”¨åŸŸæŸ¥æ‰¾ã€‚\nè¿™é‡Œè°ƒç”¨`applyMixin`æ–¹æ³•ï¼Œå®ƒå°†storeæ³¨å…¥åˆ°å­ç»„ä»¶ï¼Œå­ç»„ä»¶å¯é€šè¿‡this.$storeè®¿é—®store\n`// applyMixin.js`\n```js\nif (version >= 2) {\n  Vue.mixin({ beforeCreate: vuexInit })\n} \n```\napplyMixiné‡Œå¯¹ vue 1.0 å’Œ 2.0 ç‰ˆæœ¬è¿›è¡Œäº†åˆ¤æ–­ï¼Œ2.0ä¸‹åœ¨`beforeCreate`é˜¶æ®µæ³¨å…¥`store`\n```js\n// å­ç»„ä»¶å¯ä»¥é€šè¿‡this.$storeæ¥è®¿é—®store\nfunction vuexInit () {\n  const options = this.$options\n  // æ³¨å…¥store\n  // åˆå§‹æ—¶ï¼Œåœ¨æ ¹ç»„ä»¶ä¸Šï¼Œè°ƒç”¨è€…ä¼šä¼ å…¥storeï¼Œæ‰€ä»¥ä¼šè¿›å…¥ifé€»è¾‘\n  if (options.store) {\n    // optionsä¸Šçš„storeå¯ä»¥ä¸º functionï¼Œ\n    // è¿™ç±»ä¼¼äº vue é‡Œçš„ data return çš„æ˜¯ä¸ª functionï¼Œé˜²æ­¢å¤šä¸ª storeä¸‹ï¼Œé‡Œé¢çš„æ•°æ®è¢«å…±äº«\n    this.$store = typeof options.store === 'function'\n      ? options.store()\n      : options.store\n  } else if (options.parent && options.parent.$store) {\n    // åœ¨å­ç»„ä»¶ä¸Šï¼Œåˆå§‹åŒ–æ—¶æœªä¼ å…¥storeï¼Œåˆ™ä»çˆ¶ç»„ä»¶ä¸­è·å–store\n    // å…¬ç”¨äº†ä¸€ä»½åˆå§‹æ ¹ç»„ä»¶æ—¶ä¼ å…¥çš„å…¨å±€çš„store\n    this.$store = options.parent.$store\n  }\n}\n```\n### new Storeå®ä¾‹åŒ–é˜¶æ®µ\n```js\n  // pluginsä¸ºå¤–éƒ¨ä¼ å…¥çš„æ’ä»¶\n  // strictä¸ºé»˜è®¤ä¸å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼šåªèƒ½åœ¨mutationé‡Œè¿›è¡Œæ•°æ®æ›´æ”¹ï¼Œåœ¨actionç­‰å…¶ä»–ä½ç½®è¿›è¡Œæ•°æ®æ›´æ”¹ä¼šæŠ›å‡ºé”™è¯¯ï¼‰\n  const {\n    plugins = [],\n    strict = false\n  } = options\n\n  // å®šä¹‰store å†…éƒ¨çŠ¶æ€\n  // ç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨commitç¯èŠ‚çš„flagï¼Œä¿è¯åªåœ¨mutationç¯å¢ƒæ”¹å˜state\n  this._committing = false\n  // actionsæ“ä½œå¯¹è±¡\n  this._actions = Object.create(null)\n  // å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸‹çš„è®¢é˜…å‡½æ•°é›†åˆ\n  this._actionSubscribers = []\n  // mutationsæ“ä½œå¯¹è±¡\n  this._mutations = Object.create(null)\n  // å°è£…åçš„gettersé›†åˆå¯¹è±¡\n  this._wrappedGetters = Object.create(null)\n  /**\n   * æ ¼å¼åŒ– optionsï¼Œä¹Ÿæ˜¯è¯¥æºç é˜…è¯»çš„æ ¸å¿ƒé‡ç‚¹ï¼Œ\n   * åœ¨éæ¨¡å—æ¨¡å¼ï¼ˆæ™®é€šç”¨æ³•ä¼ å…¥optionsï¼‰æˆ– åœ¨æŒ‰æ¨¡å—å¼€å‘æ–¹å¼ä¼ å…¥storeæ—¶ï¼Œå­˜å‚¨å¤„ç†è¿‡çš„modules\n   * this._modules = {\n   *   root: {\n   *     context: {dispatch: Æ’, commit: Æ’},\n   *     runtime: false,\n   *     state: {â€¦},\n   *     _children: {},\n   *     _rawModule: {state: {â€¦}, actions: {â€¦}, mutations: {â€¦}, plugins: Array(1)},\n   *     namespaced: false\n   *   },\n   *   __proto__: {\n   *    get: Æ’ (path)\n   *    getNamespace: Æ’ getNamespace(path)\n   *    register: Æ’ register(path, rawModule, runtime)\n   *    unregister: Æ’ unregister(path)\n   *    update: Æ’ update$1(rawRootModule)\n   *    constructor: Æ’ ModuleCollection(rawRootModule)\n   *    __proto__: {...}\n   *   }\n   * }\n   */\n  this._modules = new ModuleCollection(options)\n  // æ¨¡å—å‘½åç©ºé—´map\n  this._modulesNamespaceMap = Object.create(null)\n  // å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸‹çš„è®¢é˜…å‡½æ•°é›†åˆ\n  this._subscribers = []\n  // vueå®ä¾‹ï¼Œç”¨åˆ°watchç›‘è§†å˜åŒ–åŠŸèƒ½\n  this._watcherVM = new Vue()\n  // ...\n  installModule(this, state, [], this._modules.root)\n\n  // initialize the store vm, which is responsible for the reactivity\n  // (also registers _wrappedGetters as computed properties)\n  resetStoreVM(this, state)\n\n  // è°ƒç”¨ä¼ å…¥çš„å„ç§æ’ä»¶\n  plugins.forEach(plugin => plugin(this))\n\n  const useDevtools = options.devtools !== undefined ? options.devtools : Vue.config.devtools\n  if (useDevtools) {\n    devtoolPlugin(this)\n  }\n```\nåœ¨ `constructor` é‡Œä¸»è¦æ“ä½œä¸ºï¼š æ ¼å¼åŒ–modulesï¼Œå®‰è£… moduleï¼Œåˆå§‹åŒ– store vm, å®‰è£… plugins\n\n### æ ¼å¼åŒ–modulesï¼Œå³ `this._modules = new ModuleCollection(options)`\nç”±äºä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€ä¼šé›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚å½“åº”ç”¨å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œstore å¯¹è±¡å°±æœ‰å¯èƒ½å˜å¾—ç›¸å½“è‡ƒè‚¿ã€‚\n\nä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼ŒVuex å…è®¸æˆ‘ä»¬å°† store åˆ†å‰²æˆæ¨¡å—ï¼ˆmoduleï¼‰ã€‚\næ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ stateã€mutationã€actionã€getterã€ç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—â€”â€”ä»ä¸Šè‡³ä¸‹è¿›è¡ŒåŒæ ·æ–¹å¼çš„åˆ†å‰²ï¼š\n```js\nconst moduleA = {\n  state: { ... },\n  mutations: { ... },\n  actions: { ... },\n  getters: { ... }\n}\n\nconst moduleB = {\n  state: { ... },\n  mutations: { ... },\n  actions: { ... }\n}\n\nconst store = new Vuex.Store({\n  state: { ... },\n  modules: {\n    a: moduleA,\n    b: moduleB\n  }\n})\n```\nä»£ç è¢«åˆ†å‰²åˆ° `./module/module-collection` æ–‡ä»¶å¤¹ä¸‹ã€‚\nåˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ `register` æ–¹æ³•\n```js\nthis.register([], rawRootModule, false)\n```\nregister æ¥æ”¶3ä¸ªå‚æ•°\n  * pathï¼šè·¯å¾„ï¼Œæ¨¡å—treeçš„è·¯å¾„\n  * rawModuleï¼šæœ€åˆ `new Store` æ—¶ä¼ å…¥çš„ `options`\n  * runtimeï¼šæ˜¯å¦æ˜¯è¿è¡Œæ—¶åˆ›å»ºçš„æ¨¡å—,åœ¨åˆå§‹åŒ–æ ¹æ¨¡å—æ—¶ä¸º falseï¼Œ å…¶ä»–æƒ…å†µä¸º trueï¼Œç†è§£ä¸º åˆå§‹åŒ–æ—¶çš„ flag\n\nå¦‚åˆå§‹åŒ– register æ—¶ï¼Œå‚æ•°ä¸ºï¼š`path: [], rawModule: options, runtime: false`\n```js\nregister (path, rawModule, runtime = true) {// path: [], rawModule: options, runtime: false\n  if (process.env.NODE_ENV !== 'production') {\n    // å¯¹æ„é€ å™¨ä¼ å…¥çš„optionsçš„gettersã€mutationsã€actionsè¿›è¡Œdevç¯å¢ƒçš„æ ¼å¼æ ¡éªŒ\n    // éé¢„æœŸçš„æ ¼å¼ä¼šæŠ›å‡ºé”™è¯¯\n    assertRawModule(path, rawModule)\n  }\n\n  // åˆå§‹åŒ–module\n  const newModule = new Module(rawModule, runtime)\n  // ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œifä»£ç å—ï¼Œpathä¸º[]\n  if (path.length === 0) {\n    this.root = newModule\n  } else {\n    // è·å–å½“å‰moduleçš„parent\n    const parent = this.get(path.slice(0, -1))\n    // æ·»åŠ child\n    parent.addChild(path[path.length - 1], newModule)\n  }\n\n  // é€’å½’æ³¨å†ŒåµŒå¥—çš„module\n  if (rawModule.modules) {\n    forEachValue(rawModule.modules, (rawChildModule, key) => {\n      this.register(path.concat(key), rawChildModule, runtime)\n    })\n  }\n}\n```\nregister é‡Œçš„é€»è¾‘å¤§è‡´ä¸º\n * æ ¡éªŒä¼ å…¥çš„optionsæ ¼å¼ï¼Œéé¢„æœŸçš„æ ¼å¼ä¼šæŠ›å‡ºé”™è¯¯\n * å®ä¾‹åŒ– `Module`ï¼Œåˆå§‹åŒ–æ—¶ æ¨¡å— tree çš„æ ¹å³ä¸º rootï¼Œä¹‹å addChild æ·»åŠ çš„å­æ¨¡å— å³ä¼šæ”¾å…¥åˆ° root._children é‡Œï¼Œé€çº§å¯¹åŒ…å«çš„æ‰€ä»¥æ¨¡å—è¿›è¡Œé€’å½’ registerï¼Œä»¥å½¢å¼ æ¨¡å— tree\n\nrootæ ¼å¼å¦‚ä¸‹ï¼š\n```js\nroot: {\n  context: {dispatch: Æ’, commit: Æ’},\n  runtime: false,\n  state: {â€¦},\n  _children: {},\n  _rawModule: {state: {â€¦}, actions: {â€¦}, mutations: {â€¦}, plugins: Array(1)},\n  namespaced: false\n}\n```\n#### åˆå§‹åŒ–module\n```js\n// åˆå§‹åŒ–module\nconst newModule = new Module(rawModule, runtime)\n```\nModule å®šä¹‰åœ¨ `./module/module.js` é‡Œ\n\næ„é€ å‡½æ•°ï¼š\n```js\nconstructor (rawModule, runtime) {// rawModule: options, runtime: false\n  this.runtime = runtime\n  // å­˜å‚¨moduleå­é¡¹\n  this._children = Object.create(null)\n  // å­˜å‚¨åˆå§‹åŒ–æ—¶ä¼ å…¥çš„åŸå§‹options\n  this._rawModule = rawModule\n  const rawState = rawModule.state\n\n  // å…¼å®¹moduleå½¢å¼é‡Œstateä¼ å…¥å‡½æ•°å½¢å¼ï¼Œç±»ä¼¼ ç»„ä»¶ä¸­çš„ dataï¼Œæ€»æ˜¯return ä¸€ä¸ªObjectï¼Œæ¥é˜²æ­¢å¯¹è±¡è¢«å…±äº«\n  this.state = (typeof rawState === 'function' ? rawState() : rawState) || {}\n}\n```\nå±¡ä¸‹ æ¨¡å—åˆå§‹åŒ– æ€è·¯ï¼š\n  * å¯¹åˆå§‹ä¼ å…¥çš„ options è¿›è¡Œæ¨¡å— å®ä¾‹åŒ–ï¼Œ\n  * é‡Œé¢åŒ…å«äº†å­æ¨¡å—çš„è¯ ä¼šè¢«é€’å½’ æ”¾è¿› root._children å¯¹è±¡é‡Œï¼Œå½¢æˆä¸€é¢— æ¨¡å— treeï¼Œ\n  * å¹¶ä¸” é€šè¿‡ `forEachMutation` åŒ…è£…å‡½æ•°ç­‰çš„ç±»ä¼¼æ–¹æ³•ï¼Œå­æ¨¡å—åœ¨æ‰§è¡Œ actionã€mutation æ–¹æ³•æ—¶ä¹Ÿåªæ˜¯æ‰§è¡Œçš„æ˜¯å­æ¨¡å—é‡Œå¯¹åº”çš„æ–¹æ³•ï¼Œ\n  * æ¯ä¸ªæ¨¡å—çš„ _rawModule å³ä¸º å®šä¹‰æ—¶ ä¼ å…¥çš„ options\n  * æ¯ä¸ªæ¨¡å—çš„ state å³ä¸º å®šä¹‰æ—¶ ä¼ å…¥çš„ options.state\n\n### å®‰è£…æ¨¡å—\n```js\ninstallModule(this, state, [], this._modules.root)\n```\nåœ¨æ¨¡å—è¢«åˆå§‹åŒ–å®šä¹‰åï¼Œé€šè¿‡ installModule å¯¹ state, actions, mutations, getters è¿›è¡Œåˆå§‹åŒ–å¤„ç†ã€‚\n\n```js\nfunction installModule (store, rootState, path, module, hot) {\n  // this, state(this._modules.root.state), [], this._modules.root\n  // æ˜¯rootæ—¶ï¼Œpathä¸º[]\n  const isRoot = !path.length\n  //  modules: {\n  //     a: moduleA,\n  //     b: moduleB\n  //   }\n  // modules.a çš„å‘½åç©ºé—´ä¸º 'a/'\n  const namespace = store._modules.getNamespace(path)\n\n  // å­˜å‚¨namespaceå¯¹åº”çš„moduleäº_modulesNamespaceMap\n  if (module.namespaced) {\n    store._modulesNamespaceMap[namespace] = module\n  }\n\n  // è®¾ç½® state\n  if (!isRoot && !hot) {\n    const parentState = getNestedState(rootState, path.slice(0, -1))\n    const moduleName = path[path.length - 1]\n    store._withCommit(() => {\n      Vue.set(parentState, moduleName, module.state)\n    })\n  }\n\n  const local = module.context = makeLocalContext(store, namespace, path)\n\n  // æ‹¼æ¥namespaceï¼Œå¦‚ï¼š\n  // modules: {\n  //   account: {\n  //     namespaced: true,\n  //     state: { ... }, // æ¨¡å—å†…çš„çŠ¶æ€å·²ç»æ˜¯åµŒå¥—çš„äº†ï¼Œä½¿ç”¨ `namespaced` å±æ€§ä¸ä¼šå¯¹å…¶äº§ç”Ÿå½±å“\n  //     getters: {\n  //       isAdmin () { ... } // -> getters['account/isAdmin']\n  //     },\n  //     actions: {\n  //       login () { ... } // -> dispatch('account/login')\n  //     },\n  //     mutations: {\n  //       login () { ... } // -> commit('account/login')\n  //     }\n  //   }\n  // }\n  module.forEachMutation((mutation, key) => {\n    const namespacedType = namespace + key\n    registerMutation(store, namespacedType, mutation, local)\n  })\n\n  module.forEachAction((action, key) => {\n    const type = action.root ? key : namespace + key\n    const handler = action.handler || action\n    registerAction(store, type, handler, local)\n  })\n\n  module.forEachGetter((getter, key) => {\n    const namespacedType = namespace + key\n    registerGetter(store, namespacedType, getter, local)\n  })\n\n  // é€’å½’installå­é¡¹\n  module.forEachChild((child, key) => {\n    installModule(store, rootState, path.concat(key), child, hot)\n  })\n}\n```\n#### åˆ†æä¸‹ registerMutation çš„æ³¨å†Œ\nåœ¨è¿™é‡Œå…ˆé€šè¿‡ forEachMutation æ–¹æ³•, ä¼ å…¥å¯¹åº”çš„æ¨¡å—çš„ mutation å’Œ keyï¼Œ\nregisterMutation é‡Œå°†æˆ‘ä»¬é¡¹ç›®é‡Œå®šä¹‰çš„ mutations æ–¹æ³•ä»¥ key-value å½¢å¼å­˜å…¥ _mutations é‡Œï¼Œåœ¨ä¼ å…¥çš„æ—¶å€™ å°† state ä½œä¸ºç¬¬ä¸€å‚æ•°ï¼Œæˆ‘ä»¬è‡ªå·±ä¼ å…¥çš„ä¸ºç¬¬äºŒå‚æ•°å½¢å¼ï¼Œè¿™é‡Œä½¿å¾—å¦‚æ–‡æ¡£é‡Œæ‰€è¯´ä¸€æ ·å½¢å¼ä½¿ç”¨ï¼š\n```js\n// ...\nmutations: {\n  increment (state, payload) {\n    state.count += payload.amount\n  }\n}\n```\n> è¿™é‡Œä¼šå¯¹å‘½åç©ºé—´è¿›è¡Œå¤„ç†ï¼Œå‡å¦‚æ¨¡å— A ä¸­æœ‰åä¸º add çš„ mutation å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨æ³¨å†Œè¿‡ç¨‹ä¸­ä¼šå˜æˆ a/add\n\nç›¸å…³ Mutation æ³¨å†Œä»£ç ï¼š\n->>>>>>>>>>>>\n```js\nmodule.forEachMutation((mutation, key) => {\n  const namespacedType = namespace + key\n  registerMutation(store, namespacedType, mutation, local)\n})\n//\nforEachMutation (fn) {\n  if (this._rawModule.mutations) {\n    forEachValue(this._rawModule.mutations, fn)\n  }\n}\n//\nfunction registerMutation (store, type, handler, local) {\n  const entry = store._mutations[type] || (store._mutations[type] = [])\n  entry.push(function wrappedMutationHandler (payload) {\n    handler.call(store, local.state, payload)\n  })\n}\n```\n<<<<<<<<<<\n\n#### registerAction çš„æ³¨å†Œ\n```js\nfunction registerAction (store, type, handler, local) {\n  const entry = store._actions[type] || (store._actions[type] = [])\n  entry.push(function wrappedActionHandler (payload, cb) {\n    let res = handler.call(store, {\n      dispatch: local.dispatch,\n      commit: local.commit,\n      getters: local.getters,\n      state: local.state,\n      rootGetters: store.getters,\n      rootState: store.state\n    }, payload, cb)\n    if (!isPromise(res)) {\n      res = Promise.resolve(res)\n    }\n    if (store._devtoolHook) {\n      return res.catch(err => {\n        store._devtoolHook.emit('vuex:error', err)\n        throw err\n      })\n    } else {\n      return res\n    }\n  })\n}\n```\nè¿™é‡Œå°† `{ dispatch commit getters state rootGetters rootState }` ä½œä¸ºç¬¬ä¸€å‚æ•°ï¼Œå°†è‡ªå·±dispatch æ—¶ä¼ å…¥çš„å‚æ•°ä½œä¸ºç¬¬äºŒå‚æ•°ï¼Œæ‰€ä»¥æœ‰äº†æ–‡æ¡£é‡Œæ‰€è¯´çš„ä¹¦å†™å½¢å¼ï¼š\n```js\n// è‡ªå·±é¡¹ç›®é‡Œçš„ actions.js\ntoggleMenu ({ commit }) {\n  commit('TOGGLE_MENU')\n},\n// or\nsetSidebarMenuList (context, userType) {\n  context.commit('SET_SIDEBAR_MENU_LIST', userType)\n}\n```\n> registerAction é‡Œ å¤„ç†äº† promise æƒ…å†µï¼Œæ‰€ä»¥ store.dispatch å¯ä»¥å¤„ç†è¢«è§¦å‘çš„ action çš„å¤„ç†å‡½æ•°è¿”å›çš„ Promiseï¼Œå¹¶ä¸” store.dispatch ä»æ—§è¿”å› Promise\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ¥å†™ï¼š\n```js\nlogin({commit}, user){\n  return new Promise((resolve, reject) => {\n    commit('auth_request')\n    axios({url: '...', data: user, method: 'POST' })\n      .then(resp => {\n        const token = resp.data.token\n        const user = resp.data.user\n        localStorage.setItem('token', token)\n        axios.defaults.headers.common['Authorization'] = token\n        commit('auth_success', token, user)\n        resolve(resp)\n      })\n      .catch(err => {\n        commit('auth_error')\n        localStorage.removeItem('token')\n        reject(err)\n      })\n  })\n}\n```\n```js\nexport default {\n  methods: {\n    register () {\n      this.$store.dispatch('register', {\n        name: this.name,\n        password: this.password\n      })\n        .then(() => this.$router.push('/'))\n        .catch(err => console.log(err))\n    }\n  }\n}\n```\nå°†å¤„ç†çš„è¯·æ±‚æå–åˆ°äº†vuexé‡Œï¼Œä¹Ÿä½¿å¾—é¡µé¢é‡Œä»£ç æ›´åŠ ç®€æ´äº†ã€‚åªä¿ç•™äº†ä¸šåŠ¡é€»è¾‘ã€‚\n\n#### registerGetter çš„æ³¨å†Œ\n```js\n// ...\nreturn rawGetter(\n  local.state, // local state\n  local.getters, // local getters\n  store.state, // root state\n  store.getters // root getters\n)\n```\ngetter è¿™é‡Œå…ˆå¤„ç†äº†å‘½åç©ºé—´ï¼Œç„¶åè¿™é‡Œæ¥æ”¶ 4 ä¸ªå‚æ•°ã€‚\nå‰é¢ä¸¤ä¸ªä¸ºæ¨¡å—å†…çš„ local state ï¼Œlocal gettersï¼Œåä¸¤ä¸ªå‚æ•°ä¸ºæ ¹èŠ‚ç‚¹ä¸Šçš„å†…å®¹ root stateï¼Œroot gettersã€‚\nå½“ç„¶ï¼Œæ²¡ä½¿ç”¨æ¨¡å—å½¢å¼çš„è¯ï¼Œä¸¤è€…ç›¸åŒã€‚\n\n### resetStoreVM(this, state)\n```js\nfunction resetStoreVM (store, state, hot) {\n  const oldVm = store._vm\n\n  // bind store public getters\n  store.getters = {}\n  const wrappedGetters = store._wrappedGetters\n  const computed = {}\n  forEachValue(wrappedGetters, (fn, key) => {\n    // use computed to leverage its lazy-caching mechanism\n    computed[key] = () => fn(store)\n    Object.defineProperty(store.getters, key, {\n      get: () => store._vm[key],\n      enumerable: true // for local getters\n    })\n  })\n\n  // ...\n  store._vm = new Vue({\n    data: {\n      $$state: state\n    },\n    computed\n  })\n  // ...\n}\n```\nresetStoreVM çš„å·¥ä½œæ˜¯ å®ä¾‹åŒ–ä¸€ä¸ª vue å®ä¾‹ï¼Œå¹¶å°† getters é‡Œå®šä¹‰çš„æ–¹æ³• é€šè¿‡ Object.defineProperty æ¥è¿›è¡Œç»‘å®šåˆ° store.getters ä¸Šï¼Œ\nå¹¶ä½œä¸º computed è®¡ç®—å±æ€§ï¼Œåœ¨stateå˜åŒ–æ—¶ï¼Œgetter èƒ½å“åº”å¼å˜åŒ–ã€‚\nåœ¨å®é™…è°ƒç”¨ å³ä¸ºå¦‚ä¸‹å…³ç³»ï¼š\n```js\n// è¿™é‡Œä½¿å¾—vm.$store.state å–åˆ° vm._data.$$state\nget state () {\n  return this._vm._data.$$state\n}\n```\n```js\nstore.state = store._vm._data.$$state\nstore.getters.a = store.a = store._vm._data.$$state.a\n```\nVuex è¿˜æœ‰ä¸€äº›mapå¼€å¤´çš„è¾…åŠ©å‡½æ•°ï¼Œè¿™äº› handler é€šè¿‡ hook è¾¾åˆ°äº†ç®€å†™çš„ç›®çš„ã€‚\nVuex æœ¬èº«æ˜¯ Vue çš„æ’ä»¶å½¢å¼ï¼Œå…¶è‡ªèº«ç»§ç»­å»¶ç»­æ”¯æŒæ’ä»¶å½¢å¼ã€‚`replaceState`,`subscribe`é€šå¸¸ä¼šåœ¨æ’ä»¶é‡Œç”¨åˆ°ã€‚\n```js\nstore.subscribe((mutation, state) => {\n  console.log(mutation.type)\n  console.log(mutation.payload)\n})\n```",
    "__v": 0
  },
  {
    "_id": "5c4b2ef6425f444b816c7a18",
    "meta": {
      "createDate": "2019-01-25 23:44:55",
      "updateDate": "2019-05-05 17:43:35"
    },
    "tags": [
      "ç¬”è®°"
    ],
    "title": "æµè§ˆå™¨ç›¸å…³çŸ¥è¯†ç‚¹",
    "content": "### æµè§ˆå™¨è¾“å…¥urlåˆ°çœ‹åˆ°é¡µé¢\bçš„æµç¨‹\n* DNSè§£æ\n  - DNSæœåŠ¡å™¨å¯¹åŸŸåè§£æï¼Œå¾—åˆ°ç›®æ ‡æœåŠ¡å™¨çš„IPåï¼Œè¿›è¡ŒHTTPè®¿é—®\n* â†“\n* åº”ç”¨å±‚ã€HTTPæ•°æ®ã€‘\n* â†“\n* ä¼ è¾“å±‚ã€TCPåè®®ï¼šç¡®ä¿å¯é æ€§ã€‘\n  - ä¸ºäº†ä¼ è¾“æ–¹ä¾¿ï¼Œåœ¨ä¼ è¾“å±‚ï¼ˆTCP åè®®ï¼‰æŠŠä»åº”ç”¨å±‚å¤„æ”¶åˆ°çš„æ•°æ®ï¼ˆHTTP è¯·æ±‚æŠ¥æ–‡ï¼‰è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åœ¨å„ä¸ªæŠ¥æ–‡ä¸Šæ‰“ä¸Šæ ‡è®°åºå·åŠç«¯å£å·åè½¬å‘ç»™ç½‘ç»œå±‚ã€‚\n  - ä¸‰æ¬¡æ¡æ‰‹ğŸ¤\n    - æ¡æ‰‹è¿‡ç¨‹ä¸­ä½¿ç”¨äº†TCPçš„æ ‡å¿— [flag] â€”â€” SYN [synchronize] å’Œ ACK [acknowledgement]\n        - \bå‘é€ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªå¸¦ SYN æ ‡å¿—çš„æ•°æ®åŒ…ç»™å¯¹æ–¹ã€‚\n        - æ¥æ”¶ç«¯æ”¶åˆ°åï¼Œå›ä¼ ä¸€ä¸ªå¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…ä»¥ç¤ºä¼ è¾¾ç¡®è®¤ä¿¡æ¯ã€‚\n        - æœ€åï¼Œå‘é€ç«¯å†å›ä¼ ä¸€ä¸ªå¸¦ ACK æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œä»£è¡¨â€œæ¡æ‰‹â€ç»“æŸã€‚è‹¥åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­æŸä¸ªé˜¶æ®µè«åä¸­æ–­ï¼ŒTCP åè®®ä¼šå†æ¬¡ä»¥ç›¸åŒçš„é¡ºåºå‘é€ç›¸åŒçš„æ•°æ®åŒ…ã€‚<br><img src=\"https://gitee.com/ryanxchen/img/raw/master/blog/tcp-3-call.jpg\" width=\"420px\" height=\"280px\">\n  - é™¤äº†ä¸Šè¿°ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCP åè®®è¿˜æœ‰å…¶ä»–å„ç§æ‰‹æ®µæ¥ä¿è¯é€šä¿¡çš„å¯é æ€§\n* â†“\n* ç½‘ç»œå±‚ã€IPåè®®ï¼šè´Ÿè´£ä¼ è¾“ã€ARPåè®®ï¼šåœ°å€è§£æåè®®ã€‘\n  - å¢åŠ ä½œä¸ºé€šä¿¡ç›®çš„åœ°çš„ MAC åœ°å€\n  - ARP æ˜¯ä¸€ç§ç”¨ä»¥è§£æåœ°å€çš„åè®®ï¼Œæ ¹æ®é€šä¿¡æ–¹çš„ IP åœ°å€å°±å¯ä»¥åæŸ¥å‡ºå¯¹åº”çš„ MAC åœ°å€\n* â†“\n* æ•°æ®é“¾è·¯å±‚\n* â†“\n* æœåŠ¡å™¨\n  - æ•°æ®é“¾è·¯å±‚æ¥æ”¶ï¼Œ\b\bæŒ‰åºå¾€ä¸Šå±‚å‘é€ï¼Œå¹¶æŠŠå¯¹åº”çš„é¦–éƒ¨æ¶ˆå»ï¼ŒTCPæŒ‰åºé‡ç»„è¯·æ±‚æŠ¥æ–‡ï¼ŒHTTPå¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”\n* â†“\n* å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”å†…å®¹\n* â†“\n* æµè§ˆå™¨å¾—åˆ°èµ„æºå†…å®¹/æŠ¥æ–‡ï¼Œè¿›è¡Œè§£ææ¸²æŸ“\n  * æ£€æŸ¥HTMLå¹¶æ„å»ºDOM\n    - å­—èŠ‚ -> å­—ç¬¦ä¸² -> node -> DOM\n  * æ£€æŸ¥CSSå¹¶æ„å»ºCSSOMã€CSS Object Modelï¼Œæ˜¯ä¸€ä¸ªå»ºç«‹åœ¨webé¡µé¢ä¸Šçš„ CSS æ ·å¼çš„æ˜ å°„ã€‘\n    - å­—èŠ‚ -> å­—ç¬¦ä¸² -> node -> DOM\n  * Webæµè§ˆå™¨å°†DOMå’ŒCSSOMç»“åˆï¼Œå¹¶æ„å»ºå‡ºæ¸²æŸ“æ ‘ï¼ˆrender treeï¼‰\n    - åŒ…å«èŠ‚ç‚¹\bå’ŒèŠ‚ç‚¹æ ·å¼ä¿¡æ¯\n  * æ¸²æŸ“å¼•æ“\bæ ¹æ® RenderTree å¼€å§‹æ¸²æŸ“å’Œå±•ç¤º\n    - å¸ƒå±€ï¼ˆå›æµï¼‰ï¼šç¡®å®šèŠ‚ç‚¹ä½ç½®å’Œå¤§å°\n    - ç»˜åˆ¶ï¼šè°ƒç”¨CPUï¼Œåˆæˆå›¾å±‚ï¼Œæ˜¾ç¤ºä¸å±å¹•\n  * é‡åˆ° scriptã€link ä¼šé˜»å¡\n* æ–­å¼€è¿æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹ğŸ‘‹<br>\n<img src=\"https://gitee.com/ryanxchen/img/raw/master/blog/http-tcp.jpg\" width=\"450px\" height=\"450px\">\n<br>\n<hr>\n<br>\n<img src=\"https://gitee.com/ryanxchen/img/raw/master/blog/all.jpg\" width=\"500px\" height=\"700px\">\n\n### åè®®å¯¹åº”OSIä¸ƒå±‚æ¨¡å‹ä½ç½®ï¼š\n* ç‰©ç†å±‚\n* æ•°æ®é“¾è·¯å±‚\n* ç½‘ç»œå±‚\n  - IP\n* ä¼ è¾“å±‚\n  - TCP\n  - UDP(User Data Protocal): ç”¨æˆ·æ•°æ®æŠ¥åè®®\n    - ä¸å¯é ï¼Œå¯èƒ½ä¸¢åŒ…è€Œä¸”åŒ…çš„é¡ºåºæ€§ä¹Ÿä¸èƒ½ä¿è¯\n* ä¼šè¯å±‚\n* è¡¨ç¤ºå±‚\n* åº”ç”¨å±‚\n  - http\n\n### é‡ç»˜ã€å›æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n* ç½‘é¡µç”Ÿæˆæ—¶ï¼Œè‡³å°‘ä¼šæ¸²æŸ“ä¸€æ¬¡ï¼Œåœ¨ç”¨æˆ·\bè®¿é—®è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šä¸æ–­é‡æ–°æ¸²æŸ“\n* é‡ç»˜æ˜¯å½“èŠ‚ç‚¹éœ€è¦æ›´æ”¹å¤–è§‚è€Œä¸å½±å“å¸ƒå±€ï¼Œå¦‚ï¼šcolorçš„æ”¹å˜\n* \bå›æµæ˜¯å¸ƒå±€æˆ–è€…å‡ ä½•å±æ€§çš„æ”¹å˜ï¼Œå¦‚ï¼šwidthã€heightçš„æ”¹å˜\n* \bå›æµå¿…å®šå‘ç”Ÿé‡ç»˜ï¼Œé‡ç»˜æœªå¿…å¼•å‘å›æµ\n\n### async å’Œ defer æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n* async å¦‚æœå·²ç»åŠ è½½å¥½ï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œ\n* \bdefer ä¸é˜»å¡ HTML çš„è§£æï¼ŒHTMLè§£æå®Œåï¼Œå†æ‰§è¡Œ\n* åŠ è½½å¤šä¸ªJSè„šæœ¬ï¼Œasyncæ— åºåŠ è½½ï¼Œè€Œdeferæœ‰åºåŠ è½½\n  - å¦‚åŠ è½½ è°·æ­Œç»Ÿè®¡ä»£ç ï¼Œä½¿ç”¨async\n  - åŠ è½½ JSç›¸äº’ä¾èµ–ä»£ç ï¼Œä½¿ç”¨deferï¼Œå¦‚ jQuery.jsã€jQuery-plugin.js\n\n### ä¸ºä»€ä¹ˆæ“ä½œDOMæ…¢ï¼Ÿ\n* ç›¸å½“äºä¸åŒçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡\n* å¯èƒ½å¸¦æ¥é‡ç»˜ã€å›æµ\n\n### å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜\n> å¼ºç¼“å­˜æ˜¯ä¸ç»è¿‡æœåŠ¡å™¨çš„, åå•†ç¼“å­˜æ˜¯ç»è¿‡æœåŠ¡å™¨çš„\n\n> å¼ºç¼“å­˜å¯èƒ½ä»æœ¬åœ°å†…å­˜è·å–ï¼Œä¹Ÿå¯èƒ½ä»æœ¬åœ°ç£ç›˜å†…è¯»å–\n\n* å¼ºç¼“å­˜ç›¸å…³å­—æ®µ(Expires(å“åº”å¤´), Cache-Control(å“åº”å¤´)),\n  > Cache-Controlä¼˜å…ˆçº§å¤§äºExpires\n  - Cache-Control \n    - no-cacheï¼šå¼ºåˆ¶å‘æºæœåŠ¡å™¨å†æ¬¡éªŒè¯\n    - no-storeï¼šä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹ï¼Œ**è¿™æ‰æ˜¯çœŸçš„'no-cache'ä¸ç¼“å­˜**\n    - ...\n* åå•†ç¼“å­˜ç›¸å…³å­—æ®µ(Last-Modified(å“åº”å¤´), If-Modified-Since(è¯·æ±‚å¤´), Etag(å“åº”å¤´), If-None-Match(è¯·æ±‚å¤´))\n\nHTTP ç¼“å­˜æœºåˆ¶æµç¨‹å›¾:\n\n![catch](https://gitee.com/ryanxchen/img/raw/master/blog/cache.jpeg)\n\n### ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥å´æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ\n\n\n<hr>\n\n[å‚è€ƒ-å›¾è§£HTTP](https://book.douban.com/subject/25863515/)<br>\n[å‚è€ƒ-Introduction to the CSS Object Model](https://varvy.com/performance/cssom.html)<br>\n[å‚è€ƒ-æ˜é‡‘æ–‡ç« -æ·±å…¥æµ…å‡ºæµè§ˆå™¨æ¸²æŸ“åŸç†](https://juejin.im/post/5c24d736f265da614b120d4a)<br>\n[å‚è€ƒ-æ˜é‡‘æ–‡ç« -TCPçš„ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹](https://juejin.im/post/5a0444d45188255ea95b66bc)<br>\n[å‚è€ƒ-segmentfaultæ–‡ç« -ä»URLè¾“å…¥åˆ°é¡µé¢å±•ç°åˆ°åº•å‘ç”Ÿä»€ä¹ˆï¼Ÿ](https://segmentfault.com/a/1190000017184701)<br>\n[å‚è€ƒ-github.com/MuYunyun/blog](https://github.com/MuYunyun/blog/blob/master/BasicSkill/http/http.md)\n\nARPåè®®ç›¸å…³èµ„æ–™ï¼š[ARPåè®®ç™¾åº¦ç™¾ç§‘](https://baike.baidu.com/item/ARP/609343)\n",
    "__v": 0
  },
  {
    "_id": "5c4672b79f894d0f47f5f53c",
    "meta": {
      "createDate": "2019-01-22 09:32:39",
      "updateDate": "2019-01-22 09:32:39"
    },
    "tags": [
      "javascript"
    ],
    "title": "å·²çŸ¥å¹´æœˆï¼Œæ±‚è¯¥æœˆå…±å¤šå°‘å¤©ï¼Ÿ",
    "content": "åœ¨å†™æ—¥å†ç»„ä»¶æ—¶ï¼Œæ›¾é‡åˆ° **å·²çŸ¥å¹´æœˆï¼Œæ±‚è¯¥æœˆå…±å¤šå°‘å¤©ï¼Ÿ** è¿™æ ·çš„éœ€æ±‚ã€‚\n\næœ€å¼€å§‹æ€è·¯ä¼šæ˜¯ï¼š\n\n* å…ˆåˆ¤æ–­è¯¥å¹´ä»½æ˜¯å¦æ˜¯é—°å¹´ï¼Œæ¥å¤„ç† 2 æœˆä»½æƒ…å†µï¼Œé—°å¹´ 2 æœˆå…± 29 å¤©ï¼Œéé—°å¹´ 2 æœˆå…± 28 å¤©\n* å†åˆ¤æ–­å…¶ä»–æœˆä»½ï¼Œå¦‚ 1 æœˆå…± 31 å¤©ï¼Œ4 æœˆå…± 30 å¤©\n\nä»£ç å°±ä¸ä¸€ä¸€åˆ—å‡ºäº†ï¼Œæ€è·¯ä»£ç å•¥çš„æ²¡å•¥é—®é¢˜ã€‚\n\nè¿™é‡Œå…¶å®æœ‰ç§æ›´ç®€ä¾¿çš„æ–¹æ³•ï¼Œå€ŸåŠ© `Date` API å¤„ç†æ—¥æœŸæº¢å‡ºæ—¶ï¼Œä¼šè‡ªåŠ¨å¾€åæ¨å»¶å“åº”æ—¶é—´çš„è§„åˆ™ï¼Œç›´æ¥ä¸Šä»£ç ï¼š\n\n```js\n// month å€¼éœ€å¯¹åº”å®é™…æœˆä»½å‡ä¸€ï¼Œå¦‚å®é™… 2 æœˆï¼Œmonth ä¸º 1ï¼Œå®é™… 3 æœˆï¼Œmonth ä¸º 2\nfunction getMonthCountDay (year, month) {\n  return 32 - new Date(year, month, 32).getDate()\n}\n```\n\néªŒè¯ä¸‹ï¼š\n\n```js\n// æ±‚é—°å¹´çš„ 2 æœˆä»½æ€»å¤©æ•°\ngetMonthCountDay(2000, 1) // 29\n// æ±‚éé—°å¹´çš„ 2 æœˆä»½æ€»å¤©æ•°\ngetMonthCountDay(2001, 1) // 28\n// æ±‚ 1 æœˆä»½æ€»å¤©æ•°\ngetMonthCountDay(2000, 0) // 31\ngetMonthCountDay(2001, 0) // 31\n// æ±‚ 4 æœˆä»½æ€»å¤©æ•°\ngetMonthCountDay(2000, 3) // 30\ngetMonthCountDay(2001, 3) // 30\n```",
    "__v": 0
  },
  {
    "_id": "5c45d9fe9f894d0f47f5f53b",
    "meta": {
      "createDate": "2019-01-21 22:41:02",
      "updateDate": "2019-01-21 22:43:24"
    },
    "tags": [
      "css"
    ],
    "title": "CSSé‡Œçš„BFC",
    "content": "## BFCæ¦‚å¿µ\nå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰ æ˜¯Webé¡µé¢çš„å¯è§†åŒ–CSSæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å¸ƒå±€è¿‡ç¨‹ä¸­ç”Ÿæˆå—çº§ç›’å­çš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ çš„äº¤äº’é™å®šåŒºåŸŸã€‚æ˜¯CSS2.1è§„èŒƒå®šä¹‰çš„å†…å®¹ã€‚\n\n**ä¸‹åˆ—æ–¹å¼ä¼šåˆ›å»ºå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼š**\n\n* æ ¹å…ƒç´ æˆ–åŒ…å«æ ¹å…ƒç´ çš„å…ƒç´ \n* æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ `float` ä¸æ˜¯ `none`ï¼‰\n* ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ `position` ä¸º `absolute` æˆ– `fixed`ï¼‰\n* è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ `display` ä¸º `inline-block`ï¼‰\n* è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ `display`ä¸º `table-cell`ï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n* è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ `display` ä¸º `table-caption`ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n* åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆå…ƒç´ çš„ `display`ä¸º `table`ã€`table-row`ã€ `table-row-group`ã€t`able-header-group`ã€`table-footer-group`ï¼ˆåˆ†åˆ«æ˜¯HTML tableã€rowã€tbodyã€theadã€tfootçš„é»˜è®¤å±æ€§ï¼‰æˆ– `inline-table`ï¼‰\n* overflow å€¼ä¸ä¸º `visible` çš„å—å…ƒç´ \n* display å€¼ä¸º `flow-root` çš„å…ƒç´ \n* contain å€¼ä¸º `layout`ã€`content`æˆ– `strict` çš„å…ƒç´ \n* å¼¹æ€§å…ƒç´ ï¼ˆ`display`ä¸º `flex` æˆ– `inline-flex`å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n* ç½‘æ ¼å…ƒç´ ï¼ˆ`displayä¸º` `grid` æˆ– `inline-grid` å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n* å¤šåˆ—å®¹å™¨ï¼ˆå…ƒç´ çš„ `column-count` æˆ– `column-width` ä¸ä¸º `auto`ï¼ŒåŒ…æ‹¬ `column-count` ä¸º 1ï¼‰\n* `column-span` ä¸º `all` çš„å…ƒç´ å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BFCï¼Œå³ä½¿è¯¥å…ƒç´ æ²¡æœ‰åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ï¼ˆæ ‡å‡†å˜æ›´ï¼ŒChrome bugï¼‰ã€‚\n\n*å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡åŒ…å«åˆ›å»ºå®ƒçš„å…ƒç´ å†…éƒ¨çš„æ‰€æœ‰å†…å®¹.*\n\n> æ ¹å…ƒç´ å³ä¸ºä¸€ä¸ªBFC\n\n### ç‰¹æ€§\n\n* å±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»Boxçš„marginä¼šå‘ç”Ÿé‡å ï¼Œä¸æ–¹å‘æ— å…³ï¼Œä»…ä¿ç•™è¾ƒå¤§çš„marginå€¼\n* æ¶ˆé™¤ä¸æµ®åŠ¨å…ƒç´ çš„é‡å \n* å¯åˆ¶é€ å†…éƒ¨æµ®åŠ¨ï¼ˆè®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—ï¼‰\n* æ¯ä¸ªå…ƒç´ çš„margin-leftï¼Œä¸åŒ…å«å—border-leftç›¸æ¥è§¦(å¯¹äºä»å·¦å¾€å³çš„æ ¼å¼åŒ–ï¼Œå¦åˆ™ç›¸å)ã€‚å³ä½¿å­˜åœ¨æµ®åŠ¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆè§demoé‡Œçš„part3ï¼‰ã€‚\n### demo\n[demo](https://codepen.io/ryanxchen/pen/OdLbwq)\n\n### æ€»ç»“\nBFCæ˜¯æ–‡æ¡£å†…å…ƒç´ æ˜¾ç¤ºçš„ä¸€ç§å½¢å¼ï¼Œæ¦‚å¿µæœ‰ç‚¹æŠ½è±¡,å¯æƒ³åƒæˆåœ¨æ–‡æ¡£é‡Œä¸ºä¸€ä¸ªå¯†é—­çš„ç©ºé—´ï¼Œä¸å¤–éƒ¨è¿›è¡Œäº†éš”ç¦»ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¹å…ƒç´ å³ä¸ºBFCã€‚æ‰€ä»¥åœ¨æ ¹å…ƒç´ å†…éƒ¨çš„å…ƒç´ å‚ç›´æ–¹å‘ä¼šäº§ç”Ÿmarginé‡åˆï¼Œæµ®åŠ¨å…ƒç´ ä¼šäº§ç”Ÿå…ƒç´ é‡å ï¼ŒBFCå¯æ¶ˆé™¤å…ƒç´ å†…çš„å­\bå…ƒç´ æµ®åŠ¨äº§ç”Ÿçš„ä¸åŒ…å«æƒ…å†µç­‰ç‰¹æ€§ã€‚\n\n[å‚è€ƒMDNé“¾æ¥](https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Block_formatting_context)",
    "__v": 1
  },
  {
    "_id": "5c376a7c9f894d0f47f5f53a",
    "meta": {
      "createDate": "2019-01-10 23:53:32",
      "updateDate": "2019-01-15 17:03:36"
    },
    "tags": [
      "javascript"
    ],
    "title": "ç®€å•å®ç°æµ…æ‹·è´ä¸æ·±æ‹·è´",
    "content": "### æ·±æµ…æ‹·è´åŒºåˆ«\næµ…æ‹·è´åªå¤åˆ¶ç¬¬ä¸€å±‚å¯æšä¸¾çš„å±æ€§å€¼ï¼Œæ·±æ‹·è´å¯¹æ¯ä¸€å±‚é‡Œçš„å¯æšä¸¾çš„å±æ€§å€¼éƒ½è¿›è¡Œå¤åˆ¶ã€‚\n\n* ### ç®€å•å®ç°æµ…æ‹·è´\n\n```js\nfunction copy (source) {\n  if (source === null || typeof source !== 'object') return source;\n  const copy = Array.isArray(source) ? [] : {};\n\n  Object.keys(source).forEach(key => {\n    copy[key] = source[key]\n  })\n  return copy\n}\n```\næµ…æ‹·è´çš„å®ç°æœ‰\n  - `Object.assign` \n  - `...`å±•å¼€è¯­æ³•\n  - `Array.prototype.slice()`\n  - æ•°ç»„çš„`concat`\n \n  \n* ### ç®€å•å®ç°æ·±æ‹·è´\n\n```js\nfunction deepCopy (source) {\n  if (source === null || typeof source !== 'object') return source;\n  const copy = Array.isArray(source) ? [] : {};\n\n  Object.keys(source).forEach(key => {\n    copy[key] = deepCopy(source[key])\n  })\n  return copy\n}\n```\n`JSON.parse(JSON.stringify(source))` æ˜¯å¯¹æ·±æ‹·è´çš„å®ç°\n\nä½†å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š\n\n *  æ‹·è´JSONä¸­ä¸æ”¯æŒçš„ç±»å‹ä¼šæœ‰é—®é¢˜ï¼Œå¦‚`Date`ç±»å‹æ‹·è´æ—¶ï¼Œä¼šè½¬åŒ–ä¸ºå¸¦Tæ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸²",
    "__v": 0
  },
  {
    "_id": "5c2a1441b042777d45a5859d",
    "meta": {
      "createDate": "2018-12-31 21:06:09",
      "updateDate": "2019-05-05 14:20:49"
    },
    "tags": [
      "ç¬”è®°"
    ],
    "title": "Centos6.8ä¸‹å®‰è£…jenkins",
    "content": "æœ¬åšå®¢ä½¿ç”¨äº†jenkinsè¿›è¡ŒæŒç»­é›†æˆï¼Œåœ¨é…ç½®è…¾è®¯äº‘æ—¶ï¼Œé¡ºä¾¿è®°å½•ä¸‹é…ç½®è¿‡ç¨‹ã€‚å®‰è£…jenkinsçš„æ–¹å¼[å®˜ç½‘](https://jenkins.io/doc/book/installing/) ç»™å‡ºäº†å¤šç§ï¼Œè¿™é‡Œä½¿ç”¨äº†waråŒ…æ–‡ä»¶æ–¹å¼å®‰è£…ã€‚\n\n## ä¸€ã€å®‰è£…å‰æ\n\n### 1ã€å®‰è£…java1.8ç‰ˆæœ¬\n\nJenkins ä¾èµ–äº1.8ç‰ˆæœ¬çš„javaã€‚\n\nä½¿ç”¨yumï¼Œå®‰è£…java1.8ï¼Œæ‰§è¡Œ\n\n```shell\nyum install -y java-1.8.0-openjdk.x86_64\n```\n\nå®‰è£…ä»¥åæ‰§è¡Œ `java -version` çœ‹ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚\n\n### 2ã€æ·»åŠ ç¯å¢ƒå˜é‡\n\næ¥ç€åœ¨ /etc/profileæ–‡ä»¶é‡Œæ·»åŠ javaçš„ç¯å¢ƒå˜é‡\n\n```shell\nvim  /etc/profile\n```\n\nåœ¨æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n```\nJAVA_HOME=/usr/java/jdk1.8.0_74\nJRE_HOME=/usr/java/jdk1.8.0_74/jre\nPATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin\nCLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib\n```\n\næ‰§è¡Œä¿®æ”¹ç”Ÿæ•ˆå‘½ä»¤ï¼š`source /etc/profile`\n\næŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆå‘½ä»¤ï¼š`echo $PATH`\n\n## äºŒã€jenkinsç›¸å…³\n\n### 1ã€ä¸‹è½½jenkins waråŒ…\n\njavaå®‰è£…çš„å‡†å¤‡å·¥ä½œåšå®Œäº†ï¼Œæ¥ç€æ ¹æ®[å®˜ç½‘](https://pkg.jenkins.io/redhat/)æä¾›çš„Centosä¸‹çš„jenkinsä¸‹è½½æ–¹å¼ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n```shell\nsudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo\nsudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key\n```\n\næ‰¾åˆ°åˆšä¸‹è½½çš„å®‰è£…åŒ…ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n`rpm -ql jenkins`\n\nç»“æœå¦‚ä¸‹ï¼š\n\n```shell\n[root@VM_160_98_centos ~]# rpm -ql jenkins\n/etc/init.d/jenkins\n/etc/logrotate.d/jenkins\n/etc/sysconfig/jenkins\n/usr/lib/jenkins\n/usr/lib/jenkins/jenkins.war\n/usr/sbin/rcjenkins\n/var/cache/jenkins\n/var/lib/jenkins\n/var/log/jenkins\n```\n\n`/usr/lib/jenkins/jenkins.war`å°±æ˜¯waråŒ…çš„ä½ç½®äº†ã€‚\n\n### 2ã€é»˜è®¤å¯åŠ¨ç«¯å£\n\nè¿™é‡Œå…ˆé¡ºä¾¿ä¿®æ”¹ä¸‹jenkinsçš„8080é»˜è®¤å¯åŠ¨ç«¯å£ã€‚(æŸ¥çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µå‘½ä»¤ï¼š`netstat -ntlp`)\n\nä¿®æ”¹ç«¯å£çš„æ–‡ä»¶å‘½ä»¤ä¸ºï¼š`vim /etc/sysconfig/jenkins`ï¼Œæ‰¾åˆ°é‡Œé¢çš„`JENKINS_PORT=\"8080\"`ï¼Œæˆ‘è¿™é‡Œæ”¹ä¸ºäº†5555ï¼Œæ²¡éœ€æ±‚å¯ä¸ä¿®æ”¹ã€‚\n\n### 3ã€è¿è¡Œjenkins\n\nè¿è¡Œjenkinså‘½ä»¤ä¸”é€€å‡ºå‘½ä»¤è¡Œä¸å½±å“ç¨‹åºæ‰§è¡Œï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n\n`java -jar /usr/lib/jenkins/jenkins.war --httpPort=5555 &`\n\nå…¶ä¸­ `&` ç¬¦å·ä½¿å¾—é€€å‡ºå‘½ä»¤è¡Œä¸å½±å“ç¨‹åºæ‰§è¡Œã€‚\n\n### 4ã€æ·»åŠ nginx ä»£ç†ç«¯å£è®¾ç½®\n\næ¥ç€åœ¨nginxé‡Œé…ç½®ä»£ç†åˆ°5555ç«¯å£ï¼Œä½¿å¾—å¤–ç½‘èƒ½è®¿é—®ã€‚\n\næ¥ç€åˆ°æœåŠ¡å™¨åå°ç®¡ç†ï¼ˆæˆ‘æœåŠ¡å™¨æ˜¯è…¾è®¯äº‘ï¼‰æ·»åŠ å­åŸŸåå’Œåœ¨å®‰å…¨ç»„é‡Œæ·»åŠ 5555ç«¯å£çš„å…¥ç«™è§„åˆ™ã€‚\n\nè¿™æ ·jenkinså°±ç®—å®‰è£…å®Œæˆäº†ã€‚[http://jenkins.ryanxchen.com](http://jenkins.ryanxchen.com)\n\n## é™„ï¼šJenkins é»˜è®¤æ’ä»¶\n\n![é»˜è®¤æ’ä»¶](https://gitee.com/ryanxchen/img/raw/master/blog/jenkins-default-plugin-ls.jpg)\n\n* Floders Plugin\n* OWASP markup formatter plugin\n* Build timeout plugin\n* Credentials binding plugin\n* timestamper\n* Workspace cleanup plugin\n* ant plugin\n* Gradle plugin\n* pipeline\n* Github organization floder plugin\n* pipeline stage view plugin\n* Git plugin\n* subversion plugin\n* SSH slaves plugin\n* Matrix authorization stragegy plugin\n* PAM authentication plugin\n* LDAP plugin\n* Email extension plugin\n* Mailer plugin\n\nå…±19ä¸ªé»˜è®¤æ’ä»¶\n\n",
    "__v": 1
  }
]
